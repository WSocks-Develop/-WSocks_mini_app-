<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WSocks VPN</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.7.2/dist/axios.min.js"></script>
  <script src="https://unpkg.com/@twa-dev/sdk@7.10.0/dist/telegram-web-apps.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="./texts.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f0f4f8;
      color: #1f2a44;
    }
    .container {
      max-width: 420px;
      margin: 0 auto;
      min-height: 100vh;
      background-color: white;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      overflow-x: hidden;
      position: relative;
    }
    .header {
      position: sticky;
      top: 0;
      background-color: #3b82f6;
      color: white;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      z-index: 10;
    }
    .header-title {
      flex: 1;
      font-size: 18px;
      font-weight: 600;
      text-align: center;
    }
    .back-button {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 4px 8px;
    }
    .back-button:disabled {
      cursor: not-allowed;
      pointer-events: none;
    }
    .content {
      padding: 16px;
    }
    .logo {
      text-align: center;
      margin-bottom: 16px;
    }
    .logo-text {
      font-size: 24px;
      font-weight: 700;
      color: #1f2a44;
    }
    .button {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 8px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s;
    }
    .button:disabled {
      cursor: not-allowed;
      pointer-events: none;
    }
    .button:hover:not(:disabled) {
      transform: translateY(-1px);
    }
    .button:active:not(:disabled) {
      transform: translateY(0);
    }
    .button-primary {
      background-color: #3b82f6;
      color: white;
    }
    .button-primary:hover:not(:disabled) {
      background-color: #2563eb;
    }
    .button-secondary {
      background-color: #6b7280;
      color: white;
    }
    .button-secondary:hover:not(:disabled) {
      background-color: #4b5563;
    }
    .button-success {
      background-color: #10b981;
      color: white;
    }
    .button-success:hover:not(:disabled) {
      background-color: #059669;
    }
    .button-danger {
      background-color: #ef4444;
      color: white;
    }
    .button-danger:hover:not(:disabled) {
      background-color: #dc2626;
    }
    .button-icon {
      margin-right: 8px;
      font-size: 20px;
    }
    .card {
      background-color: #f9fafb;
      padding: 16px;
      margin-bottom: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    .card p {
      font-size: 14px;
      margin: 8px 0;
      color: #374151;
    }
    .card b {
      color: #1f2a44;
    }
    .error {
      color: #dc2626;
      font-size: 14px;
      text-align: center;
      margin-bottom: 16px;
    }
    .link {
      color: #3b82f6;
      text-decoration: none;
      font-weight: 600;
    }
    .link:hover {
      text-decoration: underline;
    }
    .tooltip {
      position: relative;
      display: inline-block;
      width: 100%;
    }
    .tooltip .tooltip-text {
      visibility: hidden;
      background-color: #1f2a44;
      color: white;
      text-align: center;
      border-radius: 4px;
      padding: 4px 8px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
    .clickable {
      color: #3b82f6;
      cursor: pointer;
      font-weight: 600;
    }
    .clickable:hover {
      text-decoration: underline;
    }
    .clickable-manual {
      cursor: pointer;
      color: inherit;
      font-weight: 600;
    }
    .clickable-manual:hover {
      text-decoration: none;
    }
    .manual-content {
      font-size: 14px;
      color: #374151;
      line-height: 1.5;
    }
    .manual-content a {
      color: #3b82f6;
      text-decoration: none;
      font-weight: 600;
    }
    .manual-content a:hover {
      text-decoration: underline;
    }
    .manual-content pre {
      background-color: #e5e7eb;
      padding: 8px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .manual-content code {
      font-family: monospace;
      font-size: 12px;
    }
    .manual-content ul {
      list-style-type: disc;
      margin-left: 20px;
      margin-bottom: 8px;
    }
    .manual-content li {
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/javascript">
    const { useState, useEffect, createElement: h } = React;

    // –§—É–Ω–∫—Ü–∏—è debounce –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
    function debounce(func, wait) {
      let timeout;
      return function (...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    function App() {
      const [user, setUser] = useState(null);
      const [view, setView] = useState('main');
      const [subscriptions, setSubscriptions] = useState([]);
      const [referrals, setReferrals] = useState([]);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      const [paymentData, setPaymentData] = useState(() => {
        const saved = localStorage.getItem('paymentData');
        return saved ? JSON.parse(saved) : null;
      });
      const [selectedSub, setSelectedSub] = useState(() => {
        const saved = localStorage.getItem('selectedSub');
        return saved ? JSON.parse(saved) : null;
      });
      const [selectedReferee, setSelectedReferee] = useState(null);
      const [processingActions, setProcessingActions] = useState({});

      const API_URL = 'https://wsocks-api-bot-o2if.onrender.com';
      const SUPPORT_LINK = 'https://t.me/WSocks_Support';
      const SUPPORT_HANDLE = '@WSocks_Support';
      const BOT_USERNAME = 't.me/penis2008_bot'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–º—è –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
      const axiosInstance = axios.create({ timeout: 0 });

      useEffect(() => {
        localStorage.setItem('view', view);
        localStorage.setItem('paymentData', JSON.stringify(paymentData));
        localStorage.setItem('selectedSub', JSON.stringify(selectedSub));
      }, [view, paymentData, selectedSub]);

      useEffect(() => {
        console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...');
        if (!window.Telegram?.WebApp) {
          setError('Telegram Web App SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
          setLoading(false);
          return;
        }

        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        const initData = Telegram.WebApp.initData;
        console.log('InitData:', initData);

        if (!initData) {
          setError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å initData');
          setLoading(false);
          return;
        }

        setLoading(true);
        axiosInstance.post(`${API_URL}/api/auth`, { init_data: initData }, {
          headers: { 'Cache-Control': 'no-cache' }
        })
          .then(({ data }) => {
            console.log('–û—Ç–≤–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', data);
            setUser(data.user);
            setLoading(false);
          })
          .catch(err => {
            console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', err);
            setError(`–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${err.response?.data?.detail || err.message}`);
            setLoading(false);
          });
      }, []);

      const fetchSubscriptions = async () => {
        if (!user) {
          setError('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
          return;
        }
        setLoading(true);
        setError(null);
        try {
          const response = await axiosInstance.get(`${API_URL}/api/subscriptions?tg_id=${user.telegram_id}`, {
            headers: { 'Cache-Control': 'no-cache' }
          });
          console.log('–û—Ç–≤–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫:', response.data);
          setSubscriptions(response.data.subscriptions || []);
          setView('subscriptions');
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫:', err);
          setError(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–æ–∫: ${err.response?.data?.detail || err.message}`);
        } finally {
          setLoading(false);
        }
      };

      const fetchReferrals = async () => {
        if (!user) {
          setError('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
          return;
        }
        setLoading(true);
        setError(null);
        try {
          const response = await axiosInstance.get(`${API_URL}/api/referrals?tg_id=${user.telegram_id}`, {
            headers: { 'Cache-Control': 'no-cache' }
          });
          console.log('–û—Ç–≤–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:', response.data);
          setReferrals(response.data.referrals || []);
          setView('referrals');
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:', err);
          setError(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤: ${err.response?.data?.detail || err.message}`);
        } finally {
          setLoading(false);
        }
      };

      const activateSubscription = debounce(async (days, isExtension = false, email = null, requestId) => {
        if (!user) {
          setError('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
          return;
        }
        if (processingActions[requestId]) {
          return;
        }
        setProcessingActions(prev => ({ ...prev, [requestId]: true }));
        setLoading(true);
        setError(null);
        try {
          const endpoint = isExtension ? '/api/extend-subscription' : '/api/buy-subscription';
          const payload = isExtension 
            ? { tg_id: user.telegram_id, days, email }
            : { tg_id: user.telegram_id, days };
          const response = await axiosInstance.post(`${API_URL}${endpoint}`, payload);
          console.log('–û—Ç–≤–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏:', response.data);
          setPaymentData({ ...response.data, isExtension });
          setView('payment');
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏:', err);
          setError(`–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏: ${err.response?.data?.detail || err.message}`);
        } finally {
          setLoading(false);
          setProcessingActions(prev => ({ ...prev, [requestId]: false }));
        }
      }, 500);

      const activateTrial = debounce(async () => {
        if (!user) {
          setError('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
          return;
        }
        const requestId = generateRequestId();
        if (processingActions[requestId]) {
          return;
        }
        setProcessingActions(prev => ({ ...prev, [requestId]: true }));
        setLoading(true);
        setError(null);
        try {
          const response = await axiosInstance.post(`${API_URL}/api/activate-trial`, { tg_id: user.telegram_id });
          console.log('–û—Ç–≤–µ—Ç –ø—Ä–æ–±–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏:', response.data);
          await fetchSubscriptions();
          Telegram.WebApp.showAlert(`–ü—Ä–æ–±–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ 3 –¥–Ω—è –¥–æ ${response.data.expiry_date}!`);
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–±–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏:', err);
          Telegram.WebApp.showAlert(err.response?.data?.detail || '–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–±–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏');
        } finally {
          setLoading(false);
          setProcessingActions(prev => ({ ...prev, [requestId]: false }));
        }
      }, 500);

      const applyReferralBonus = debounce(async (referee_id) => {
    try {
        setLoading(true);
        // –ó–∞–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏
        const { data } = await axiosInstance.get(`${API_URL}/api/subscriptions?tg_id=${user.telegram_id}`);
        const nonTrialSubs = data.subscriptions.filter(sub => !sub.email.startsWith('DE-FRA-TRIAL-'));
        
        if (nonTrialSubs.length === 0) {
            // –£—Å–ª–æ–≤–∏–µ 1: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø–æ–¥–ø–∏—Å–∫—É
            const response = await axiosInstance.post(`${API_URL}/api/apply-referral-bonus`, {
                tg_id: user.telegram_id,
                referee_id,
                email: null
            });
            setReferrals(prev => prev.map(ref =>
                ref.referee_id === referee_id ? { ...ref, bonus_applied: true, bonus_date: new Date() } : ref
            ));
            alert(`–ë–æ–Ω—É—Å –ø—Ä–∏–º–µ–Ω—ë–Ω! –ù–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞: ${response.data.email}`);
        } else if (nonTrialSubs.length === 1) {
            // –£—Å–ª–æ–≤–∏–µ 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–ª–∏—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É
            const response = await axiosInstance.post(`${API_URL}/api/apply-referral-bonus`, {
                tg_id: user.telegram_id,
                referee_id,
                email: nonTrialSubs[0].email
            });
            setReferrals(prev => prev.map(ref =>
                ref.referee_id === referee_id ? { ...ref, bonus_applied: true, bonus_date: new Date() } : ref
            ));
            alert(`–ë–æ–Ω—É—Å –ø—Ä–∏–º–µ–Ω—ë–Ω! –ü–æ–¥–ø–∏—Å–∫–∞ ${nonTrialSubs[0].email} –ø—Ä–æ–¥–ª–µ–Ω–∞ –¥–æ ${response.data.expiry_date}`);
        } else {
            // –£—Å–ª–æ–≤–∏–µ 3: –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ø–æ–¥–ø–∏—Å–∫–∏
            setView('select-subscription');
            setSelectedRefereeId(referee_id);
            setSubscriptions(nonTrialSubs);
        }
    } catch (error) {
        console.error('Error applying referral bonus:', error);
        alert(`–û—à–∏–±–∫–∞: ${error.response?.data?.detail || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å –±–æ–Ω—É—Å'}`);
    } finally {
        setLoading(false);
    }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–¥–ø–∏—Å–∫–∏
const selectSubscription = async (email) => {
    try {
        setLoading(true);
        const response = await axiosInstance.post(`${API_URL}/api/apply-referral-bonus`, {
            tg_id: user.telegram_id,
            referee_id: selectedRefereeId,
            email
        });
        setReferrals(prev => prev.map(ref =>
            ref.referee_id === selectedRefereeId ? { ...ref, bonus_applied: true, bonus_date: new Date() } : ref
        ));
        setView('referrals');
        alert(`–ë–æ–Ω—É—Å –ø—Ä–∏–º–µ–Ω—ë–Ω! –ü–æ–¥–ø–∏—Å–∫–∞ ${email} –ø—Ä–æ–¥–ª–µ–Ω–∞ –¥–æ ${response.data.expiry_date}`);
    } catch (error) {
        console.error('Error applying referral bonus:', error);
        alert(`–û—à–∏–±–∫–∞: ${error.response?.data?.detail || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å –±–æ–Ω—É—Å'}`);
    } finally {
        setLoading(false);
    }
};
          setProcessingActions(prev => ({ ...prev, [requestId]: false }));
        }
      }, 500);

      const confirmActivation = async () => {
        if (!user || !paymentData) {
          setError('–î–∞–Ω–Ω—ã–µ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');
          return;
        }
        setLoading(true);
        setError(null);
        try {
          setView('subscriptions');
          await fetchSubscriptions();
          Telegram.WebApp.showAlert(
            paymentData.isExtension 
              ? `–ü–æ–¥–ø–∏—Å–∫–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–¥–ª–µ–Ω–∞ –Ω–∞ ${paymentData.days} –¥–Ω–µ–π –¥–æ ${paymentData.expiry_date}!` 
              : `–ü–æ–¥–ø–∏—Å–∫–∞ —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ ${paymentData.days} –¥–Ω–µ–π –¥–æ ${paymentData.expiry_date}!`
          );
          setPaymentData(null);
          localStorage.removeItem('paymentData');
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:', err);
          setError(`–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏: ${err.message}`);
        } finally {
          setLoading(false);
        }
      };

      const handleRetry = (action) => {
        setError(null);
        action();
      };

      const generateRequestId = () => {
        return `${Date.now()}_${Math.random().toString(36).substring(2, 11)}`;
      };

      const copyToClipboard = (text) => {
        navigator.clipboard.writeText(text).then(() => {
          Telegram.WebApp.showAlert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
        }).catch(err => {
          console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
          Telegram.WebApp.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç');
        });
      };

      const Header = ({ title, onBack }) =>
        h('div', { className: 'header' }, [
          onBack && h('button', { className: 'back-button', onClick: onBack, disabled: loading }, '‚Üê'),
          h('div', { className: 'header-title' }, title),
          onBack && h('div', { style: { width: '40px' } }),
        ]);

      const renderMainMenu = () =>
        h('div', { className: 'container' }, [
          Header({ title: 'WSocks VPN' }),
          h('div', { className: 'content' }, [
            h('div', { className: 'logo' }, h('div', { className: 'logo-text' }, 'WSocks VPN')),
            user && h('p', { style: { marginBottom: '16px', textAlign: 'center', fontSize: '16px' } }, `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.first_name}!`),
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => window.location.reload() }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-danger', onClick: () => Telegram.WebApp.close() }, '–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ'),
            !error && h('div', { className: 'tooltip' }, [
              h('button', { className: 'button button-primary', onClick: fetchReferrals, disabled: loading }, [
                h('span', { className: 'button-icon' }, 'üë•'),
                '–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞',
              ]),
              h('span', { className: 'tooltip-text' }, '–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –±–æ–Ω—É—Å—ã'),
            ]),
            !error && h('div', { className: 'tooltip' }, [
              h('button', { className: 'button button-primary', onClick: fetchSubscriptions, disabled: loading }, [
                h('span', { className: 'button-icon' }, 'üõí'),
                '–ü–æ–¥–ø–∏—Å–∫–∏',
              ]),
              h('span', { className: 'tooltip-text' }, '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–∏–º–∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏'),
            ]),
            !error && h('div', { className: 'tooltip' }, [
              h('button', { className: 'button button-primary', onClick: () => setView('info'), disabled: loading }, [
                h('span', { className: 'button-icon' }, 'üìå'),
                '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
              ]),
              h('span', { className: 'tooltip-text' }, '–£–∑–Ω–∞–π—Ç–µ –±–æ–ª—å—à–µ –æ WSocks VPN'),
            ]),
            !error && h('div', { className: 'tooltip' }, [
              h('button', { className: 'button button-primary', onClick: () => setView('support'), disabled: loading }, [
                h('span', { className: 'button-icon' }, '‚ù§Ô∏è'),
                '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Telegram',
              ]),
              h('span', { className: 'tooltip-text' }, '–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π'),
            ]),
          ]),
        ]);

      const renderSupport = () =>
        h('div', { className: 'container' }, [
          Header({ title: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞', onBack: () => setView('main') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('support')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('main') }, '–ù–∞–∑–∞–¥'),
            !error && h('div', { className: 'card' }, [
              h('p', null, [
                '–î–ª—è —Å–≤—è–∑–∏ —Å –Ω–∞—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—é–¥–∞, ',
                h('span', {
                  className: 'clickable',
                  onClick: () => Telegram.WebApp.openLink(SUPPORT_LINK)
                }, SUPPORT_HANDLE),
                ' –∏ –Ω–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –æ—Ç–≤–µ—Ç–∏—Ç –≤–∞–º –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è!',
              ]),
              h('p', null, [
                '–í–∞—à id –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º: üëâüèø ',
                h('span', {
                  className: 'clickable',
                  onClick: () => copyToClipboard(user.telegram_id)
                }, user.telegram_id),
                ' üëàüèø',
              ]),
              h('p', { style: { fontStyle: 'italic' } }, '(–Ω–∞–∂–º–∏—Ç–µ –Ω–∞ id —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å)'),
            ]),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('main'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderReferrals = () =>
        h('div', { className: 'container' }, [
          Header({ title: '–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞', onBack: () => setView('main') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(fetchReferrals) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('main') }, '–ù–∞–∑–∞–¥'),
            !error && h('p', { className: 'card' }, [
              '–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ ',
              h('b', null, '7 –¥–Ω–µ–π'),
              ' –±–µ—Å–ø–ª–∞—Ç–Ω–æ:'
            ]),
            !error && user && h('div', { className: 'card' }, [
              h('p', null, [
                '–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: ',
                h('span', {
                  className: 'clickable',
                  onClick: () => copyToClipboard(`${BOT_USERNAME}?start=ref_${user.telegram_id}`)
                }, `${BOT_USERNAME}?start=ref_${user.telegram_id}`),
              ]),
              h('p', { style: { fontStyle: 'italic' } }, '(–Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å)'),
            ]),
            !error && referrals.length === 0 && h('p', { className: 'card' }, '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤.'),
            !error && referrals.map((ref, index) =>
              h('div', { key: index, className: 'card' }, [
                h('p', null, [h('b', null, 'ID —Ä–µ—Ñ–µ—Ä–∞–ª–∞: '), ref.referee_id]),
                ref.bonus_applied
                  ? h('p', null, [
                      h('b', null, '–ë–æ–Ω—É—Å –ø–æ–ª—É—á–µ–Ω: '),
                      new Date(ref.bonus_date).toLocaleString()
                    ])
                  : h('button', {
                      className: 'button button-success',
                      onClick: () => applyReferralBonus(ref.referee_id),
                      disabled: loading
                    }, [
                      h('span', { className: 'button-icon' }, 'üéÅ'),
                      '–ü–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å'
                    ])
              ])
            ),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('main'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderSubscriptions = () =>
        h('div', { className: 'container' }, [
          Header({ title: '–ü–æ–¥–ø–∏—Å–∫–∏', onBack: () => setView('main') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(fetchSubscriptions) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('main') }, '–ù–∞–∑–∞–¥'),
            !error && subscriptions.length === 0 && h('p', { className: 'card' }, '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫.'),
            !error && subscriptions.map((sub, index) =>
              h('div', { key: index, className: 'card' }, [
                h('p', null, [h('b', null, 'Email: '), sub.email]),
                h('p', null, [h('b', null, '–ü–∞–Ω–µ–ª—å: '), sub.panel]),
                h('p', null, [h('b', null, '–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è: '), new Date(sub.expiry_date).toLocaleString()]),
                h('p', null, [h('b', null, '–°—Ç–∞—Ç—É—Å: '), sub.is_expired ? '–ò—Å—Ç—ë–∫' : '–ê–∫—Ç–∏–≤–Ω–∞']),
                h('div', { style: { display: 'flex', gap: '8px', marginTop: '8px' } }, [
                  !sub.email.startsWith('DE-FRA-TRIAL-') && h('button', {
                    className: 'button button-success',
                    onClick: () => { setSelectedSub(sub); setView('extend'); },
                    disabled: loading
                  }, '–ü—Ä–æ–¥–ª–∏—Ç—å'),
                  h('button', {
                    className: 'button button-primary',
                    onClick: () => { setSelectedSub(sub); setView('setup'); },
                    disabled: loading
                  }, '–ù–∞—Å—Ç—Ä–æ–π–∫–∞'),
                ]),
              ])
            ),
            !error && h('div', { className: 'tooltip' }, [
              h('button', { className: 'button button-primary', onClick: activateTrial, disabled: loading }, [
                h('span', { className: 'button-icon' }, 'üéÅ'),
                '–ü—Ä–æ–±–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞',
              ]),
              h('span', { className: 'tooltip-text' }, '–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ 3 –¥–Ω—è'),
            ]),
            !error && h('button', { className: 'button button-primary', onClick: () => setView('buy'), disabled: loading }, [
              h('span', { className: 'button-icon' }, 'üí≥'),
              '–ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É',
            ]),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('main'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderBuy = () =>
        h('div', { className: 'container' }, [
          Header({ title: '–ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É', onBack: () => setView('subscriptions') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => activateSubscription(30, false, null, generateRequestId())) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('subscriptions') }, '–ù–∞–∑–∞–¥'),
            !error && h('button', { className: 'button button-primary', onClick: () => activateSubscription(30, false, null, generateRequestId()), disabled: loading || processingActions['buy-30'] }, [
              '30 –¥–Ω–µ–π - 89 ‚ÇΩ',
            ]),
            !error && h('button', { className: 'button button-primary', onClick: () => activateSubscription(90, false, null, generateRequestId()), disabled: loading || processingActions['buy-90'] }, [
              '90 –¥–Ω–µ–π - 249 ‚ÇΩ',
            ]),
            !error && h('button', { className: 'button button-primary', onClick: () => activateSubscription(180, false, null, generateRequestId()), disabled: loading || processingActions['buy-180'] }, [
              '180 –¥–Ω–µ–π - 449 ‚ÇΩ',
            ]),
            !error && h('button', { className: 'button button-primary', onClick: () => activateSubscription(360, false, null, generateRequestId()), disabled: loading || processingActions['buy-360'] }, [
              '360 –¥–Ω–µ–π - 849 ‚ÇΩ',
            ]),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('subscriptions'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderExtend = () =>
        h('div', { className: 'container' }, [
          Header({ title: '–ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É', onBack: () => setView('subscriptions') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => activateSubscription(30, true, selectedSub.email, generateRequestId())) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('subscriptions') }, '–ù–∞–∑–∞–¥'),
            !error && selectedSub && h('p', { className: 'card' }, [h('b', null, 'Email: '), selectedSub.email]),
            !error && selectedSub && h('p', { className: 'card' }, [h('b', null, '–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è: '), new Date(selectedSub.expiry_date).toLocaleString()]),
            !error && h('button', { className: 'button button-primary', onClick: () => activateSubscription(30, true, selectedSub.email, generateRequestId()), disabled: loading || processingActions['extend-30'] }, [
              '–ü—Ä–æ–¥–ª–∏—Ç—å –Ω–∞ 30 –¥–Ω–µ–π - 89 ‚ÇΩ',
            ]),
            !error && h('button', { className: 'button button-primary', onClick: () => activateSubscription(90, true, selectedSub.email, generateRequestId()), disabled: loading || processingActions['extend-90'] }, [
              '–ü—Ä–æ–¥–ª–∏—Ç—å –Ω–∞ 90 –¥–Ω–µ–π - 249 ‚ÇΩ',
            ]),
            !error && h('button', { className: 'button button-primary', onClick: () => activateSubscription(180, true, selectedSub.email, generateRequestId()), disabled: loading || processingActions['extend-180'] }, [
              '–ü—Ä–æ–¥–ª–∏—Ç—å –Ω–∞ 180 –¥–Ω–µ–π - 449 ‚ÇΩ',
            ]),
            !error && h('button', { className: 'button button-primary', onClick: () => activateSubscription(360, true, selectedSub.email, generateRequestId()), disabled: loading || processingActions['extend-360'] }, [
              '–ü—Ä–æ–¥–ª–∏—Ç—å –Ω–∞ 360 –¥–Ω–µ–π - 849 ‚ÇΩ',
            ]),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('subscriptions'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderSelectSubscription = () =>
        h('div', { className: 'container' }, [
          Header({ title: '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É', onBack: () => setView('referrals') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => applyReferralBonus(selectedReferee)) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('referrals') }, '–ù–∞–∑–∞–¥'),
            !error && h('p', { className: 'card' }, '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è –Ω–∞ 7 –¥–Ω–µ–π:'),
            !error && subscriptions
              .filter(sub => !sub.email.startsWith('DE-FRA-TRIAL-'))
              .map((sub, index) =>
                h('div', { key: index, className: 'card' }, [
                  h('p', null, [h('b', null, 'Email: '), sub.email]),
                  h('p', null, [h('b', null, '–ü–∞–Ω–µ–ª—å: '), sub.panel]),
                  h('p', null, [h('b', null, '–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è: '), new Date(sub.expiry_date).toLocaleString()]),
                  h('button', {
                    className: 'button button-success',
                    onClick: () => applyReferralBonus(selectedReferee, sub.email),
                    disabled: loading
                  }, [
                    h('span', { className: 'button-icon' }, 'üéÅ'),
                    '–ü—Ä–æ–¥–ª–∏—Ç—å –Ω–∞ 7 –¥–Ω–µ–π'
                  ]),
                ])
              ),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('referrals'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderPayment = () =>
        h('div', { className: 'container' }, [
          Header({ title: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏', onBack: () => { setPaymentData(null); localStorage.removeItem('paymentData'); setView('subscriptions'); } }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(confirmActivation) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => { setPaymentData(null); localStorage.removeItem('paymentData'); setView('subscriptions'); } }, '–ù–∞–∑–∞–¥'),
            !error && paymentData && h('p', { className: 'card' }, `–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ ${paymentData.days} –¥–Ω–µ–π`),
            !error && paymentData && h('p', { className: 'card' }, [h('b', null, '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: '), paymentData.email]),
            !error && paymentData && h('p', { className: 'card' }, [h('b', null, '–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è: '), new Date(paymentData.expiry_date).toLocaleString()]),
            !error && paymentData && h('button', { className: 'button button-success', onClick: confirmActivation, disabled: loading }, [
              h('span', { className: 'button-icon' }, '‚úÖ'),
              '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å',
            ]),
            !error && paymentData && h('button', { className: 'button button-danger', onClick: () => { setPaymentData(null); localStorage.removeItem('paymentData'); setView('subscriptions'); }, disabled: loading }, [
              h('span', { className: 'button-icon' }, '‚ùå'),
              '–û—Ç–º–µ–Ω–∞',
            ]),
          ]),
        ]);

      const renderSetup = () =>
        h('div', { className: 'container' }, [
          Header({ title: '–ù–∞—Å—Ç—Ä–æ–π–∫–∞', onBack: () => setView('subscriptions') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('setup')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('subscriptions') }, '–ù–∞–∑–∞–¥'),
            !error && h('p', { className: 'card' }, [h('b', null, 'Email: '), selectedSub.email]),
            !error && h('button', { className: 'button button-primary', onClick: () => setView('manualPC'), disabled: loading }, [
              h('span', { className: 'button-icon' }, 'üíª'),
              window.TEXTS.setup.manualPC.title,
            ]),
            !error && h('button', { className: 'button button-primary', onClick: () => setView('manualAndroid'), disabled: loading }, [
              h('span', { className: 'button-icon' }, 'üì±'),
              window.TEXTS.setup.manualAndroid.title,
            ]),
            !error && h('button', { className: 'button button-primary', onClick: () => setView('manualIOS'), disabled: loading }, [
              h('span', { className: 'button-icon' }, 'üçè'),
              window.TEXTS.setup.manualIOS.title,
            ]),
            !error && h('button', { className: 'button button-primary', onClick: () => setView('manualAndroidTV'), disabled: loading }, [
              h('span', { className: 'button-icon' }, 'üì∫'),
              window.TEXTS.setup.manualAndroidTV.title,
            ]),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('subscriptions'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderManualPC = () =>
        h('div', { className: 'container' }, [
          Header({ title: window.TEXTS.setup.manualPC.title, onBack: () => setView('setup') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('manualPC')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('setup') }, '–ù–∞–∑–∞–¥'),
            !error && selectedSub && h('div', { className: 'card' }, [
              h('div', { className: 'manual-content', dangerouslySetInnerHTML: { __html: window.TEXTS.setup.manualPC.content(selectedSub) } })
            ]),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('setup'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderManualAndroid = () =>
        h('div', { className: 'container' }, [
          Header({ title: window.TEXTS.setup.manualAndroid.title, onBack: () => setView('setup') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('manualAndroid')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('setup') }, '–ù–∞–∑–∞–¥'),
            !error && h('div', { className: 'card' }, [
              h('div', { className: 'manual-content', dangerouslySetInnerHTML: { __html: window.TEXTS.setup.manualAndroid.content } })
            ]),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('setup'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderManualIOS = () =>
        h('div', { className: 'container' }, [
          Header({ title: window.TEXTS.setup.manualIOS.title, onBack: () => setView('setup') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('manualIOS')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('setup') }, '–ù–∞–∑–∞–¥'),
            !error && h('div', { className: 'card' }, [
              h('div', { className: 'manual-content', dangerouslySetInnerHTML: { __html: window.TEXTS.setup.manualIOS.content } })
            ]),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('setup'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderManualAndroidTV = () =>
        h('div', { className: 'container' }, [
          Header({ title: window.TEXTS.setup.manualAndroidTV.title, onBack: () => setView('setup') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('manualAndroidTV')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('setup') }, '–ù–∞–∑–∞–¥'),
            !error && selectedSub && h('div', { className: 'card' }, [
              h('div', { className: 'manual-content', dangerouslySetInnerHTML: { __html: window.TEXTS.setup.manualAndroidTV.content(selectedSub) } })
            ]),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('setup'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderInfo = () =>
        h('div', { className: 'container' }, [
          Header({ title: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', onBack: () => setView('main') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('info')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('main') }, '–ù–∞–∑–∞–¥'),
            !error && h('button', { className: 'button button-primary', onClick: () => setView('service'), disabled: loading }, [
              h('span', { className: 'button-icon' }, 'üåê'),
              '–û —Å–µ—Ä–≤–∏—Å–µ',
            ]),
            !error && h('button', { className: 'button button-primary', onClick: () => setView('subscription'), disabled: loading }, [
              h('span', { className: 'button-icon' }, 'üìã'),
              '–û –ø–æ–¥–ø–∏—Å–∫–µ',
            ]),
            !error && h('button', { className: 'button button-primary', onClick: () => setView('terms'), disabled: loading }, [
              h('span', { className: 'button-icon' }, 'üìú'),
              '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ',
            ]),
            !error && h('button', { className: 'button button-primary', onClick: () => setView('privacy'), disabled: loading }, [
              h('span', { className: 'button-icon' }, 'üîí'),
              '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏',
            ]),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('main'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderService = () =>
        h('div', { className: 'container' }, [
          Header({ title: '–û —Å–µ—Ä–≤–∏—Å–µ', onBack: () => setView('info') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('service')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('info') }, '–ù–∞–∑–∞–¥'),
            !error && h('p', { className: 'card' }, 'WSocks VPN –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä—ã –≤ –ì–µ—Ä–º–∞–Ω–∏–∏. –ú—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –≤—ã—Å–æ–∫—É—é —Å–∫–æ—Ä–æ—Å—Ç—å. –°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã TLS+Vless+TCP+Reality –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.'),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('info'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderSubscription = () =>
        h('div', { className: 'container' }, [
          Header({ title: '–û –ø–æ–¥–ø–∏—Å–∫–µ', onBack: () => setView('info') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('subscription')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('info') }, '–ù–∞–∑–∞–¥'),
            !error && h('div', { className: 'card' }, [
              h('p', null, [h('b', null, '–°—Ç–æ–∏–º–æ—Å—Ç—å:'), ' 89 ‚ÇΩ/–º–µ—Å—è—Ü']),
              h('p', null, [h('b', null, '–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏:'), ' –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç']),
              h('p', null, [h('b', null, '–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞:'), ' –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π']),
              h('p', null, [h('b', null, '–ü—Ä–æ—Ç–æ–∫–æ–ª—ã:'), ' TLS+Vless']),
              h('p', null, [h('b', null, '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è:'), ' Amnesia, NekoBox']),
              h('p', null, [h('b', null, '–ú–∞–∫—Å. —É—Å—Ç—Ä–æ–π—Å—Ç–≤:'), ' 3']),
              h('p', null, [h('b', null, '–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:'), ' –î–æ–±–∞–≤—å—Ç–µ –∏–≥—Ä—ã –∏–ª–∏ —Ç–æ—Ä—Ä–µ–Ω—Ç—ã –≤ –∏—Å–∫–ª—é—á–µ–Ω–∏—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏.']),
            ]),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('info'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderTerms = () =>
        h('div', { className: 'container' }, [
          Header({ title: window.TEXTS.terms.title, onBack: () => setView('info') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('terms')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('info') }, '–ù–∞–∑–∞–¥'),
            !error && h('div', { className: 'card' }, [
              h('div', { className: 'manual-content', dangerouslySetInnerHTML: { __html: window.TEXTS.terms.content } })
            ]),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('info'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const renderPrivacy = () =>
        h('div', { className: 'container' }, [
          Header({ title: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏', onBack: () => setView('info') }),
          h('div', { className: 'content' }, [
            error && h('p', { className: 'error' }, error),
            error && h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('privacy')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            error && h('button', { className: 'button button-secondary', onClick: () => setView('info') }, '–ù–∞–∑–∞–¥'),
            !error && h('p', { className: 'card' }, 'WSocks VPN —É–≤–∞–∂–∞–µ—Ç –≤–∞—à—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ Telegram. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ —Å—Å—ã–ª–∫–µ:'),
            !error && h('button', { className: 'button button-primary', onClick: () => Telegram.WebApp.openLink('https://telegra.ph/Politika-konfidencialnosti-08-04-7'), disabled: loading }, [
              h('span', { className: 'button-icon' }, 'üîí'),
              '–û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É',
            ]),
            !error && h('button', { className: 'button button-secondary', onClick: () => setView('info'), disabled: loading }, '–ù–∞–∑–∞–¥'),
          ]),
        ]);

      const views = {
        main: renderMainMenu,
        support: renderSupport,
        referrals: renderReferrals,
        subscriptions: renderSubscriptions,
        buy: renderBuy,
        extend: renderExtend,
        selectsubscription: renderSelectSubscription,
        payment: renderPayment,
        setup: renderSetup,
        manualPC: renderManualPC,
        manualAndroid: renderManualAndroid,
        manualIOS: renderManualIOS,
        manualAndroidTV: renderManualAndroidTV,
        info: renderInfo,
        service: renderService,
        subscription: renderSubscription,
        terms: renderTerms,
        privacy: renderPrivacy,
      };

      return user
        ? h('div', null, views[view]())
        : h('div', { className: 'container' }, [
            Header({ title: 'WSocks VPN' }),
            h('div', { className: 'content' }, [
              error && h('p', { className: 'error' }, error),
              error && h('button', { className: 'button button-primary', onClick: () => window.location.reload() }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
              error && h('button', { className: 'button button-danger', onClick: () => Telegram.WebApp.close() }, '–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ'),
              !error && h('p', { className: 'card', style: { textAlign: 'center' } }, '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...'),
            ]),
          ]);
    }

    ReactDOM.render(h(App), document.getElementById('root'));
  </script>
</body>
</html>
