<!DOCTYPE html>
     <html lang="en">
     <head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <title>WSocks VPN Mini App</title>
       <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
       <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
       <script src="https://cdn.jsdelivr.net/npm/axios@1.7.2/dist/axios.min.js"></script>
       <script src="https://unpkg.com/@twa-dev/sdk@7.10.0/dist/telegram-web-apps.js"></script>
       <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
       <style>
         /* –í–∞—à CSS –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞ */
         * {
           box-sizing: border-box;
           margin: 0;
           padding: 0;
         }
         body {
           font-family: 'Inter', sans-serif;
           background-color: #f0f4f8;
           color: #1f2a44;
         }
         .container {
           max-width: 420px;
           margin: 0 auto;
           min-height: 100vh;
           background-color: white;
           box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
           overflow-x: hidden;
         }
         .header {
           position: sticky;
           top: 0;
           background-color: #3b82f6;
           color: white;
           padding: 12px 16px;
           display: flex;
           align-items: center;
           z-index: 10;
         }
         .header-title {
           flex: 1;
           font-size: 18px;
           font-weight: 600;
           text-align: center;
         }
         .back-button {
           background: none;
           border: none;
           color: white;
           font-size: 24px;
           cursor: pointer;
           padding: 4px 8px;
         }
         .content {
           padding: 16px;
         }
         .logo {
           text-align: center;
           margin-bottom: 16px;
         }
         .logo-text {
           font-size: 24px;
           font-weight: 700;
           color: #1f2a44;
         }
         .button {
           display: flex;
           align-items: center;
           width: 100%;
           padding: 12px 16px;
           margin-bottom: 8px;
           border: none;
           border-radius: 8px;
           font-size: 16px;
           font-weight: 600;
           cursor: pointer;
           transition: background-color 0.2s, transform 0.1s;
         }
         .button:hover {
           transform: translateY(-1px);
         }
         .button:active {
           transform: translateY(0);
         }
         .button-primary {
           background-color: #3b82f6;
           color: white;
         }
         .button-primary:hover {
           background-color: #2563eb;
         }
         .button-secondary {
           background-color: #6b7280;
           color: white;
         }
         .button-secondary:hover {
           background-color: #4b5563;
         }
         .button-success {
           background-color: #10b981;
           color: white;
         }
         .button-success:hover {
           background-color: #059669;
         }
         .button-danger {
           background-color: #ef4444;
           color: white;
         }
         .button-danger:hover {
           background-color: #dc2626;
         }
         .button-icon {
           margin-right: 8px;
           font-size: 20px;
         }
         .card {
           background-color: #f9fafb;
           padding: 16px;
           margin-bottom: 16px;
           border-radius: 8px;
           box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
         }
         .card p {
           font-size: 14px;
           margin: 4px 0;
           color: #374151;
         }
         .card b {
           color: #1f2a44;
         }
         .error {
           color: #dc2626;
           font-size: 14px;
           text-align: center;
           margin-bottom: 16px;
         }
         .loading {
           text-align: center;
           color: #6b7280;
           font-size: 16px;
           animation: pulse 1.5s infinite;
         }
         .link {
           color: #3b82f6;
           text-decoration: none;
           font-weight: 600;
         }
         .link:hover {
           text-decoration: underline;
         }
         @keyframes pulse {
           0%, 100% { opacity: 1; }
           50% { opacity: 0.5; }
         }
         .tooltip {
           position: relative;
           display: inline-block;
           width: 100%;
         }
         .tooltip .tooltip-text {
           visibility: hidden;
           background-color: #1f2a44;
           color: white;
           text-align: center;
           border-radius: 4px;
           padding: 4px 8px;
           position: absolute;
           z-index: 1;
           bottom: 125%;
           left: 50%;
           transform: translateX(-50%);
           font-size: 12px;
           white-space: nowrap;
           opacity: 0;
           transition: opacity 0.2s;
         }
         .tooltip:hover .tooltip-text {
           visibility: visible;
           opacity: 1;
         }
       </style>
     </head>
     <body>
       <div id="root"></div>
       <script type="text/javascript">
         const { useState, useEffect, createElement: h } = React;

         function App() {
           const [user, setUser] = useState(null);
           const [view, setView] = useState('main');
           const [subscriptions, setSubscriptions] = useState([]);
           const [loading, setLoading] = useState(true);
           const [error, setError] = useState(null);

           const API_URL = 'https://wsocks-api-bot.onrender.com'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à URL –±—ç–∫–µ–Ω–¥–∞

           useEffect(() => {
             console.log('App starting...');
             console.log('Telegram SDK:', window.Telegram?.WebApp);

             try {
               if (!window.Telegram?.WebApp) {
                 setError('Telegram Web App SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                 setLoading(false);
                 return;
               }

               Telegram.WebApp.ready();
               Telegram.WebApp.expand();
               const initData = Telegram.WebApp.initData;
               console.log('InitData:', initData);
               console.log('User:', Telegram.WebApp.initDataUnsafe.user);

               if (!initData) {
                 setError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å initData');
                 setLoading(false);
                 return;
               }

               // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
               axios.post(`${API_URL}/api/auth`, { initData })
                 .then(({ data }) => {
                   console.log('Auth response:', data);
                   setUser(data.user);
                   fetchSubscriptions(data.user.telegram_id);
                 })
                 .catch(err => {
                   console.error('Auth error:', err);
                   setError('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + (err.response?.data?.detail || err.message));
                   setLoading(false);
                 });
             } catch (e) {
               console.error('General error:', e);
               setError('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
               setLoading(false);
             }
           }, []);

           const fetchSubscriptions = async (tg_id) => {
             setLoading(true);
             try {
               const response = await axios.get(`${API_URL}/api/subscriptions?tg_id=${tg_id}`);
               console.log('Subscriptions response:', response.data);
               setSubscriptions(response.data.subscriptions || []);
             } catch (err) {
               console.error('Subscriptions error:', err);
               setError('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–æ–∫: ' + (err.response?.data?.detail || err.message));
             } finally {
               setLoading(false);
             }
           };

           const Header = ({ title, onBack }) =>
             h('div', { className: 'header' }, [
               onBack && h('button', { className: 'back-button', onClick: onBack }, '‚Üê'),
               h('div', { className: 'header-title' }, title),
               onBack && h('div', { style: { width: '40px' } }), // Spacer
             ]);

           const renderMainMenu = () =>
             h('div', { className: 'container' }, [
               Header({ title: 'WSocks VPN' }),
               h('div', { className: 'content' }, [
                 h('div', { className: 'logo' }, h('div', { className: 'logo-text' }, 'WSocks VPN')),
                 error && h('p', { className: 'error' }, error),
                 h('div', { className: 'tooltip' }, [
                   h('button', { className: 'button button-primary', onClick: () => setView('subscriptions') }, [
                     h('span', { className: 'button-icon' }, 'üõí'),
                     'Subscriptions',
                   ]),
                   h('span', { className: 'tooltip-text' }, 'Manage your subscriptions'),
                 ]),
                 h('div', { className: 'tooltip' }, [
                   h('button', { className: 'button button-primary', disabled: true }, [
                     h('span', { className: 'button-icon' }, 'üë•'),
                     'Referral System',
                   ]),
                   h('span', { className: 'tooltip-text' }, 'Invite friends for rewards'),
                 ]),
                 h('div', { className: 'tooltip' }, [
                   h('button', { className: 'button button-primary', disabled: true }, [
                     h('span', { className: 'button-icon' }, 'üìå'),
                     'Information',
                   ]),
                   h('span', { className: 'tooltip-text' }, 'Learn about WSocks VPN'),
                 ]),
                 h('div', { className: 'tooltip' }, [
                   h('button', { className: 'button button-primary', onClick: () => window.open('https://t.me/WSocks_Support') }, [
                     h('span', { className: 'button-icon' }, '‚ù§Ô∏è'),
                     'Support Chat',
                   ]),
                   h('span', { className: 'tooltip-text' }, 'Contact our support team'),
                 ]),
               ]),
             ]);

           const renderSubscriptions = () =>
             h('div', { className: 'container' }, [
               Header({ title: 'Subscriptions', onBack: () => setView('main') }),
               h('div', { className: 'content' }, [
                 error && h('p', { className: 'error' }, error),
                 loading && h('p', { className: 'loading' }, 'Loading subscriptions...'),
                 !loading && subscriptions.length === 0 && h('p', { className: 'card' }, 'No active subscriptions.'),
                 subscriptions.map((sub, index) =>
                   h('div', { key: index, className: 'card' }, [
                     h('p', null, [h('b', null, 'Email: '), sub.email]),
                     h('p', null, [h('b', null, 'Panel: '), sub.panel]),
                     h('p', null, [h('b', null, 'Expiry: '), new Date(sub.expiry_date).toLocaleString()]),
                     h('p', null, [h('b', null, 'Status: '), sub.is_expired ? 'Expired' : 'Active']),
                   ])
                 ),
                 h('button', { className: 'button button-secondary', onClick: () => setView('main') }, 'Back'),
               ]),
             ]);

           return h('div', { className: 'container' }, [
             Header({ title: 'WSocks VPN' }),
             h('div', { className: 'content' }, [
               error ? h('p', { className: 'error' }, error) : h('p', { className: 'loading' }, 'Loading user data...'),
             ]),
           ]);
         }

         ReactDOM.render(h(App), document.getElementById('root'));
       </script>
     </body>
     </html>
