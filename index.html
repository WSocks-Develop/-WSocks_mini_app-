<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WSocks VPN</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.7.2/dist/axios.min.js"></script>
  <script src="https://unpkg.com/@twa-dev/sdk@7.10.0/dist/telegram-web-apps.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <script>
    window.TEXTS = {
      setup: {
        manualPC: {
          title: 'Настройка для ПК',
          content: (sub) => `Инструкция для настройки на ПК с email: ${sub.email}`
        },
        manualAndroid: {
          title: 'Настройка для Android',
          content: 'Инструкция для настройки на Android'
        },
        manualIOS: {
          title: 'Настройка для iOS',
          content: 'Инструкция для настройки на iOS'
        },
        manualAndroidTV: {
          title: 'Настройка для Android TV',
          content: (sub) => `Инструкция для настройки на Android TV с email: ${sub.email}`
        }
      },
      terms: {
        title: 'Пользовательское соглашение',
        content: 'Текст пользовательского соглашения'
      }
    };
  </script>
  <style>
    :root[data-theme="dark"] {
      --background-color: linear-gradient(135deg, #0D1B2A 0%, #1B263B 50%, #2A3244 100%);
      --text-color: rgba(255, 255, 255, 0.9);
      --card-bg: rgba(0, 0, 0, 0.25);
      --card-border: rgba(255, 255, 255, 0.1);
      --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      --header-bg: rgba(0, 0, 0, 0.4);
      --button-bg: rgba(75, 156, 211, 0.7);
      --button-hover-bg: rgba(90, 180, 229, 0.8);
      --accent-color: #4b9cd3;
      --button-secondary-bg: rgba(31, 41, 55, 0.7);
      --button-secondary-hover-bg: rgba(55, 65, 81, 0.8);
      --button-success-bg: rgba(0, 255, 174, 0.7);
      --button-success-hover-bg: rgba(80, 255, 166, 0.8);
      --button-danger-bg: rgba(239, 68, 68, 0.7);
      --button-danger-hover-bg: rgba(220, 38, 38, 0.8);
      --shadow-color: rgba(75, 156, 211, 0.5);
      --button-glow: 0 0 15px rgba(75, 156, 211, 0.4);
      --error-color: #ef4444;
      --telegram-block-bg: rgba(75, 156, 211, 0.7);
      --glass-effect: blur(16px) saturate(180%);
      --text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      --icon-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    :root[data-theme="light"] {
      --background-color: linear-gradient(135deg, #E0E1DD 0%, #D6D8D4 50%, #C9CBC4 100%);
      --text-color: rgba(51, 51, 51, 0.9);
      --card-bg: rgba(255, 255, 255, 0.25);
      --card-border: rgba(0, 0, 0, 0.1);
      --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      --header-bg: rgba(255, 255, 255, 0.4);
      --button-bg: rgba(75, 156, 211, 0.7);
      --button-hover-bg: rgba(90, 180, 229, 0.8);
      --accent-color: #4b9cd3;
      --button-secondary-bg: rgba(107, 114, 128, 0.7);
      --button-secondary-hover-bg: rgba(75, 85, 99, 0.8);
      --button-success-bg: rgba(16, 185, 129, 0.7);
      --button-success-hover-bg: rgba(5, 150, 105, 0.8);
      --button-danger-bg: rgba(239, 68, 68, 0.7);
      --button-danger-hover-bg: rgba(220, 38, 38, 0.8);
      --shadow-color: rgba(75, 156, 211, 0.5);
      --button-glow: 0 0 15px rgba(75, 156, 211, 0.4);
      --error-color: #ef4444;
      --telegram-block-bg: rgba(75, 156, 211, 0.7);
      --glass-effect: blur(16px) saturate(180%);
      --text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      --icon-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--background-color);
      color: var(--text-color);
      overflow-x: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .container {
      max-width: 100%;
      width: 100%;
      margin: 0 auto;
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 16px;
      overflow-y: auto;
    }

    .header {
      position: sticky;
      top: 0;
      background-color: var(--header-bg);
      backdrop-filter: var(--glass-effect);
      -webkit-backdrop-filter: var(--glass-effect);
      color: var(--text-color);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      font-family: 'Oswald', sans-serif;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      transition: background-color 0.3s ease;
      border-bottom: 1px solid var(--card-border);
    }

    .header-title {
      font-size: clamp(20px, 4vw, 26px);
      font-weight: 700;
      text-align: center;
      text-shadow: var(--text-shadow);
    }

    .back-button {
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 20px;
      cursor: pointer;
      padding: 4px 8px;
      position: absolute;
      left: 16px;
      transition: color 0.3s ease;
      text-shadow: var(--text-shadow);
    }

    .back-button:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }

    .back-button:hover:not(:disabled) {
      color: var(--accent-color);
    }

    .content {
      flex: 1;
      padding-top: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .logo {
      text-align: center;
      margin-bottom: 16px;
    }

    .logo-text {
      font-family: 'Oswald', sans-serif;
      font-size: clamp(28px, 5vw, 34px);
      font-weight: 700;
      color: var(--text-color);
      text-shadow: var(--text-shadow);
    }

    .user-panel, .subscriptions-panel, .card {
      background: var(--card-bg);
      backdrop-filter: var(--glass-effect);
      -webkit-backdrop-filter: var(--glass-effect);
      border: 1px solid var(--card-border);
      box-shadow: var(--card-shadow);
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .user-panel {
      padding: 20px;
      border-radius: 12px;
      box-shadow: var(--button-glow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      opacity: 0;
      animation: slideIn 0.5s ease-out forwards;
      transform: scale(1.1);
    }

    .user-panel:hover {
      transform: scale(1.12);
      box-shadow: 0 0 20px var(--shadow-color);
    }

    .user-panel-header {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      font-size: clamp(16px, 3vw, 18px);
      font-weight: 600;
      margin-bottom: 12px;
      gap: 8px;
    }

    .user-panel-header span {
      color: var(--accent-color);
      text-shadow: var(--text-shadow);
    }

    .subscriptions-panel {
      padding: 16px;
      border-radius: 12px;
      box-shadow: var(--button-glow);
      transition: max-height 0.3s ease-out, transform 0.3s ease, box-shadow 0.3s ease;
      max-height: 0;
      overflow: hidden;
      opacity: 0;
    }

    .subscriptions-panel.open {
      max-height: 1000px;
      opacity: 1;
      padding: 16px;
    }

    .subscriptions-panel:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 20px var(--shadow-color);
    }

    .subscriptions-panel .subscription {
      background: rgba(255, 255, 255, 0.08);
      padding: 16px;
      border-radius: 10px;
      margin-bottom: 16px;
      border: 1px solid var(--card-border);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .subscriptions-panel .subscription h3 {
      font-size: clamp(14px, 2.5vw, 16px);
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      text-shadow: var(--text-shadow);
    }

    .subscriptions-panel .subscription .status-error {
      color: var(--error-color);
      text-decoration: underline;
      text-shadow: var(--text-shadow);
    }

    .subscriptions-panel .subscription p {
      font-size: clamp(12px, 2vw, 14px);
      margin-bottom: 8px;
      text-shadow: var(--text-shadow);
    }

    .subscriptions-panel .subscription .details {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 10px;
      margin-bottom: 16px;
    }

    .subscriptions-panel .subscription .details b {
      font-weight: 600;
      text-shadow: var(--text-shadow);
    }

    .subscriptions-panel .subscription .buttons {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }

    .subscriptions-panel .subscription .buttons button {
      padding: 10px 16px;
      border-radius: 8px;
      font-size: clamp(12px, 2vw, 14px);
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      backdrop-filter: var(--glass-effect);
      -webkit-backdrop-filter: var(--glass-effect);
      display: flex;
      align-items: center;
      gap: 6px;
      text-shadow: var(--text-shadow);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .subscriptions-panel .subscription .buttons .copy-button {
      background: rgba(75, 156, 211, 0.7);
      color: var(--text-color);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .subscriptions-panel .subscription .buttons .copy-button:hover {
      background: rgba(90, 180, 229, 0.8);
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
    }

    .subscriptions-panel .subscription .buttons .instruction-button {
      background: rgba(31, 41, 55, 0.7);
      color: var(--text-color);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .subscriptions-panel .subscription .buttons .instruction-button:hover {
      background: rgba(55, 65, 81, 0.8);
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
    }

    .telegram-block {
      background: var(--telegram-block-bg);
      padding: 16px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      opacity: 0;
      animation: slideIn 0.5s ease-out forwards;
      backdrop-filter: var(--glass-effect);
      -webkit-backdrop-filter: var(--glass-effect);
      border: 1px solid var(--card-border);
      box-shadow: var(--card-shadow);
    }

    .telegram-block:hover {
      background: var(--button-hover-bg);
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
    }

    .telegram-block span {
      font-size: clamp(14px, 2.5vw, 16px);
      font-weight: 600;
      color: var(--text-color);
      text-shadow: var(--text-shadow);
    }

    .telegram-block .icon {
      font-size: clamp(20px, 3vw, 24px);
      filter: drop-shadow(var(--icon-shadow));
    }

    .button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      padding: 14px 18px;
      border: none;
      border-radius: 12px;
      font-size: clamp(14px, 2.5vw, 16px);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Inter', sans-serif;
      background-color: var(--button-bg);
      color: var(--text-color);
      box-shadow: var(--button-glow);
      opacity: 0;
      animation: slideIn 0.5s ease-out forwards;
      backdrop-filter: var(--glass-effect);
      -webkit-backdrop-filter: var(--glass-effect);
      border: 1px solid var(--card-border);
      text-shadow: var(--text-shadow);
    }

    .button:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }

    .button:hover:not(:disabled) {
      background: var(--button-hover-bg);
      transform: translateY(-2px);
      box-shadow: 0 8px 15px var(--shadow-color);
    }

    .button:active:not(:disabled) {
      transform: scale(0.98);
    }

    .button-primary {
      background: var(--button-bg);
      color: var(--text-color);
    }

    .button-primary:hover:not(:disabled) {
      background: var(--button-hover-bg);
    }

    .button-square {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px;
      background: var(--button-bg);
      color: var(--text-color);
      font-size: clamp(28px, 5vw, 32px);
      font-weight: bold;
      text-align: center;
      min-height: 140px;
      transform: scale(1.2);
      border-radius: 16px;
      backdrop-filter: var(--glass-effect);
      -webkit-backdrop-filter: var(--glass-effect);
      border: 1px solid var(--card-border);
      box-shadow: var(--card-shadow);
      text-shadow: var(--text-shadow);
    }

    .button-square:hover:not(:disabled) {
      background: var(--button-hover-bg);
      transform: scale(1.22);
      box-shadow: 0 12px 20px var(--shadow-color);
    }

    .button-square .icon {
      font-size: clamp(106.67px, 20vw, 120px);
      color: #ffffff;
      filter: drop-shadow(var(--icon-shadow));
    }

    .button-square span {
      text-shadow: var(--text-shadow);
    }

    .button-secondary {
      background: var(--button-secondary-bg);
      color: var(--text-color);
    }

    .button-secondary:hover:not(:disabled) {
      background: var(--button-secondary-hover-bg);
    }

    .button-success {
      background: var(--button-success-bg);
      color: #000000;
    }

    .button-success:hover:not(:disabled) {
      background: var(--button-success-hover-bg);
    }

    .button-danger {
      background: var(--button-danger-bg);
      color: #ffffff;
    }

    .button-danger:hover:not(:disabled) {
      background: var(--button-danger-hover-bg);
    }

    .button-row {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .button-row.first-row {
      justify-content: space-between;
    }

    .button-row.second-row {
      justify-content: space-around;
    }

    .card {
      padding: 16px;
      border-radius: 12px;
      box-shadow: var(--button-glow);
      transition: all 0.3s ease;
      opacity: 0;
      animation: slideIn 0.5s ease-out forwards;
      backdrop-filter: var(--glass-effect);
      -webkit-backdrop-filter: var(--glass-effect);
      border: 1px solid var(--card-border);
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 20px var(--shadow-color);
    }

    .card p {
      font-size: clamp(12px, 2.5vw, 14px);
      margin: 10px 0;
      color: var(--text-color);
      text-shadow: var(--text-shadow);
    }

    .card b {
      color: var(--text-color);
      font-weight: 600;
      text-shadow: var(--text-shadow);
    }

    .error {
      color: var(--error-color);
      font-size: clamp(12px, 2.5vw, 14px);
      text-align: center;
      margin-bottom: 16px;
      opacity: 0;
      animation: slideIn 0.5s ease-out forwards;
      text-shadow: var(--text-shadow);
    }

    .link {
      color: var(--accent-color);
      text-decoration: none;
      font-weight: 600;
      text-shadow: var(--text-shadow);
    }

    .link:hover {
      text-decoration: underline;
    }

    .tooltip {
      position: relative;
      display: inline-block;
      width: 100%;
    }

    .tooltip .tooltip-text {
      visibility: hidden;
      background-color: var(--header-bg);
      backdrop-filter: var(--glass-effect);
      -webkit-backdrop-filter: var(--glass-effect);
      color: var(--text-color);
      text-align: center;
      border-radius: 6px;
      padding: 6px 10px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      font-size: clamp(11px, 2vw, 12px);
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.3s ease;
      border: 1px solid var(--card-border);
      box-shadow: var(--card-shadow);
      text-shadow: var(--text-shadow);
    }

    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }

    .clickable {
      color: var(--accent-color);
      cursor: pointer;
      font-weight: 600;
      text-shadow: var(--text-shadow);
    }

    .clickable:hover {
      text-decoration: underline;
    }

    .clickable-manual {
      cursor: pointer;
      color: var(--text-color);
      font-weight: 600;
      text-shadow: var(--text-shadow);
    }

    .clickable-manual:hover {
      color: var(--accent-color);
    }

    .manual-content {
      font-size: clamp(12px, 2.5vw, 14px);
      color: var(--text-color);
      line-height: 1.5;
      text-shadow: var(--text-shadow);
    }

    .manual-content a {
      color: var(--accent-color);
      text-decoration: none;
      font-weight: 600;
      text-shadow: var(--text-shadow);
    }

    .manual-content a:hover {
      text-decoration: underline;
    }

    .manual-content pre {
      background-color: var(--button-secondary-bg);
      padding: 10px;
      border-radius: 6px;
      overflow-x: auto;
      border: 1px solid var(--card-border);
      box-shadow: var(--card-shadow);
    }

    .manual-content code {
      font-family: monospace;
      font-size: clamp(11px, 2vw, 12px);
      text-shadow: var(--text-shadow);
    }

    .manual-content ul {
      list-style-type: disc;
      margin-left: 20px;
      margin-bottom: 10px;
    }

    .manual-content li {
      margin-bottom: 6px;
    }

    /* Shop styles */
    .search-bar {
      width: 100%;
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid var(--card-border);
      background: var(--card-bg);
      backdrop-filter: var(--glass-effect);
      -webkit-backdrop-filter: var(--glass-effect);
      color: var(--text-color);
      font-size: clamp(14px, 2.5vw, 16px);
      margin-bottom: 16px;
      box-shadow: var(--card-shadow);
      transition: all 0.3s ease;
    }

    .search-bar:focus {
      outline: none;
      box-shadow: 0 0 0 2px var(--accent-color);
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }

    .product-card {
      background: var(--card-bg);
      backdrop-filter: var(--glass-effect);
      -webkit-backdrop-filter: var(--glass-effect);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s ease;
      box-shadow: var(--card-shadow);
    }

    .product-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 20px var(--shadow-color);
    }

    .product-icon {
      font-size: 32px;
      margin-bottom: 8px;
      filter: drop-shadow(var(--icon-shadow));
    }

    .product-title {
      font-weight: 600;
      text-align: center;
      text-shadow: var(--text-shadow);
    }

    .product-price {
      color: var(--accent-color);
      font-weight: 700;
      text-shadow: var(--text-shadow);
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .button:nth-child(1), .card:nth-child(1), .user-panel:nth-child(1), .telegram-block:nth-child(1) { animation-delay: 0.1s; }
    .button:nth-child(2), .card:nth-child(2) { animation-delay: 0.2s; }
    .button:nth-child(3), .card:nth-child(3) { animation-delay: 0.3s; }
    .button:nth-child(4), .card:nth-child(4) { animation-delay: 0.4s; }
    .subscriptions-panel { animation-delay: 0.5s; }

    .logo { animation: scaleIn 0.6s ease-out forwards; }

    @media (max-width: 600px) {
      .container {
        padding: 8px;
      }

      .header-title {
        font-size: clamp(18px, 4vw, 22px);
      }

      .logo-text {
        font-size: clamp(24px, 5vw, 30px);
      }

      .button {
        font-size: clamp(12px, 2.5vw, 14px);
        padding: 12px 14px;
      }

      .button-square {
        font-size: clamp(24px, 5vw, 28px);
        padding: 12px;
        min-height: 120px;
      }

      .button-square .icon {
        font-size: clamp(93.33px, 20vw, 106.67px);
      }

      .user-panel-header {
        font-size: clamp(14px, 2.5vw, 16px);
      }

      .user-panel {
        transform: scale(1.05);
      }

      .user-panel:hover {
        transform: scale(1.07);
      }

      .product-grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
    }

    @media (min-width: 1200px) {
      .container {
        max-width: min(80vw, 1400px);
      }

      .header-title {
        font-size: clamp(22px, 3vw, 28px);
      }

      .logo-text {
        font-size: clamp(30px, 4vw, 36px);
      }

      .button {
        font-size: clamp(15px, 2vw, 17px);
        padding: 16px 20px;
      }

      .button-square {
        font-size: clamp(28px, 4vw, 32px);
        padding: 16px;
        min-height: 150px;
      }

      .button-square .icon {
        font-size: clamp(120px, 20vw, 133.33px);
      }

      .user-panel {
        transform: scale(1.15);
      }

      .user-panel:hover {
        transform: scale(1.17);
      }

      .product-grid {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/javascript">
    const { useState, useEffect, createElement: h } = React;

    function debounce(func, wait) {
      let timeout;
      return function (...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    function App() {
      const [user, setUser] = useState(null);
      const [view, setView] = useState('main');
      const [subscriptions, setSubscriptions] = useState([]);
      const [referrals, setReferrals] = useState([]);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      const [paymentData, setPaymentData] = useState(() => {
        const saved = localStorage.getItem('paymentData');
        return saved ? JSON.parse(saved) : null;
      });
      const [selectedSub, setSelectedSub] = useState(() => {
        const saved = localStorage.getItem('selectedSub');
        return saved ? JSON.parse(saved) : null;
      });
      const [selectedReferee, setSelectedReferee] = useState(null);
      const [processingActions, setProcessingActions] = useState({});
      const [isSubscriptionsOpen, setIsSubscriptionsOpen] = useState(false);
      const [searchQuery, setSearchQuery] = useState('');

      const API_URL = 'https://wsocks-api-bot-git.onrender.com';
      const SUPPORT_LINK = 'https://t.me/WSocks_Support';
      const SUPPORT_HANDLE = '@WSocks_Support';
      const BOT_USERNAME = '@YourBot';
      const APP_DOWNLOAD_LINK = 'https://example.com/download';
      const TELEGRAM_CHANNEL_LINK = 'https://t.me/WSocks_Channel';

      // Mock products data for the shop
      const products = [
        { id: 1, title: '30 дней VPN', price: '89 ₽', icon: 'fa-shield-alt' },
        { id: 2, title: '90 дней VPN', price: '249 ₽', icon: 'fa-shield-alt' },
        { id: 3, title: '180 дней VPN', price: '449 ₽', icon: 'fa-shield-alt' },
        { id: 4, title: '360 дней VPN', price: '849 ₽', icon: 'fa-shield-alt' },
        { id: 5, title: 'Премиум пакет', price: '999 ₽', icon: 'fa-crown' },
        { id: 6, title: 'Бизнес пакет', price: '1499 ₽', icon: 'fa-briefcase' }
      ];

      const filteredProducts = products.filter(product =>
        product.title.toLowerCase().includes(searchQuery.toLowerCase())
      );

      const axiosInstance = axios.create({ timeout: 0 });

      useEffect(() => {
        localStorage.setItem('view', view);
        localStorage.setItem('paymentData', JSON.stringify(paymentData));
        localStorage.setItem('selectedSub', JSON.stringify(selectedSub));
      }, [view, paymentData, selectedSub]);

      useEffect(() => {
        console.log('Приложение запускается...');
        if (!window.Telegram || !window.Telegram.WebApp) {
          setError('Telegram Web App SDK не загружен');
          setLoading(false);
          return;
        }

        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        const initData = Telegram.WebApp.initData;
        console.log('InitData:', initData);

        if (!initData) {
          setError('Не удалось получить initData');
          setLoading(false);
          return;
        }

        setLoading(true);
        axiosInstance.post(`${API_URL}/api/auth`, { init_data: initData }, {
          headers: { 'Cache-Control': 'no-cache' }
        })
          .then(({ data }) => {
            console.log('Ответ авторизации:', data);
            setUser(data.user);
            setLoading(false);
          })
          .catch(err => {
            console.error('Ошибка авторизации:', err);
            setError(`Ошибка авторизации: ${err.response?.data?.detail || err.message}`);
            setLoading(false);
          });
      }, []);

      const fetchSubscriptions = async () => {
        if (!user) {
          setError('Пользователь не авторизован');
          return;
        }
        setLoading(true);
        setError(null);
        try {
          const response = await axiosInstance.get(`${API_URL}/api/subscriptions?tg_id=${user.telegram_id}`, {
            headers: { 'Cache-Control': 'no-cache' }
          });
          console.log('Ответ подписок:', response.data);
          setSubscriptions(response.data.subscriptions || []);
          setView('subscriptions');
        } catch (err) {
          console.error('Ошибка подписок:', err);
          setError(`Ошибка получения подписок: ${err.response?.data?.detail || err.message}`);
        } finally {
          setLoading(false);
        }
      };

      const fetchReferrals = async () => {
        if (!user) {
          setError('Пользователь не авторизован');
          return;
        }
        setLoading(true);
        setError(null);
        try {
          const response = await axiosInstance.get(`${API_URL}/api/referrals?tg_id=${user.telegram_id}`, {
            headers: { 'Cache-Control': 'no-cache' }
          });
          console.log('Ответ рефералов:', response.data);
          setReferrals(response.data.referrals || []);
          setView('referrals');
        } catch (err) {
          console.error('Ошибка рефералов:', err);
          setError(`Ошибка получения рефералов: ${err.response?.data?.detail || err.message}`);
        } finally {
          setLoading(false);
        }
      };

      const activateSubscription = debounce(async (days, isExtension = false, email = null, requestId) => {
        if (!user) {
          setError('Пользователь не авторизован');
          return;
        }
        if (processingActions[requestId]) {
          return;
        }
        setProcessingActions(prev => ({ ...prev, [requestId]: true }));
        setLoading(true);
        setError(null);
        try {
          const endpoint = isExtension ? '/api/extend-subscription' : '/api/buy-subscription';
          const payload = isExtension 
            ? { tg_id: user.telegram_id, days, email }
            : { tg_id: user.telegram_id, days };
          const response = await axiosInstance.post(`${API_URL}${endpoint}`, payload);
          console.log('Ответ подписки:', response.data);
          setPaymentData({ ...response.data, isExtension });
          setView('payment');
        } catch (err) {
          console.error('Ошибка активации подписки:', err);
          setError(`Ошибка активации подписки: ${err.response?.data?.detail || err.message}`);
        } finally {
          setLoading(false);
          setProcessingActions(prev => ({ ...prev, [requestId]: false }));
