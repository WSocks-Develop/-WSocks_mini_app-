<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WSocks VPN</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.7.2/dist/axios.min.js"></script>
  <script src="https://unpkg.com/@twa-dev/sdk@7.10.0/dist/telegram-web-apps.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
  <script>
    // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è texts.js
    window.TEXTS = {
      setup: {
        manualPC: {
          title: '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ü–ö',
          content: (sub) => `–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ –ü–ö —Å email: ${sub.email}`
        },
        manualAndroid: {
          title: '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Android',
          content: '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ Android'
        },
        manualIOS: {
          title: '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è iOS',
          content: '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ iOS'
        },
        manualAndroidTV: {
          title: '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Android TV',
          content: (sub) => `–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ Android TV —Å email: ${sub.email}`
        }
      },
      terms: {
        title: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ',
        content: '–¢–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è'
      }
    };
  </script>
  <style>
    /* CSS Custom Properties for Themes */
    :root[data-theme="dark"] {
      --background-color: linear-gradient(135deg, #0D1B2A 0%, #1B263B 50%, #2A3244 100%);
      --text-color: #ffffff;
      --card-bg: rgba(255, 255, 255, 0.1);
      --card-border: rgba(255, 255, 255, 0.2);
      --card-blur: blur(12px);
      --header-bg: rgba(255, 255, 255, 0.1);
      --button-bg: rgba(255, 255, 255, 0.1);
      --button-hover-bg: rgba(255, 255, 255, 0.2);
      --accent-color: #4b9cd3;
      --button-secondary-bg: rgba(255, 255, 255, 0.1);
      --button-secondary-hover-bg: rgba(255, 255, 255, 0.2);
      --button-success-bg: rgba(0, 255, 174, 0.2);
      --button-success-hover-bg: rgba(0, 255, 174, 0.3);
      --button-danger-bg: rgba(239, 68, 68, 0.2);
      --button-danger-hover-bg: rgba(239, 68, 68, 0.3);
      --shadow-color: rgba(75, 156, 211, 0.3);
      --button-glow: 0 0 8px rgba(75, 156, 211, 0.3);
      --error-color: #ef4444;
      --telegram-block-bg: rgba(75, 156, 211, 0.2);
    }

    :root[data-theme="light"] {
      --background-color: linear-gradient(135deg, #E0E1DD 0%, #D6D8D4 50%, #C9CBC4 100%);
      --text-color: #333333;
      --card-bg: rgba(255, 255, 255, 0.3);
      --card-border: rgba(255, 255, 255, 0.5);
      --card-blur: blur(12px);
      --header-bg: rgba(255, 255, 255, 0.3);
      --button-bg: rgba(255, 255, 255, 0.3);
      --button-hover-bg: rgba(255, 255, 255, 0.4);
      --accent-color: #4b9cd3;
      --button-secondary-bg: rgba(255, 255, 255, 0.3);
      --button-secondary-hover-bg: rgba(255, 255, 255, 0.4);
      --button-success-bg: rgba(16, 185, 129, 0.3);
      --button-success-hover-bg: rgba(16, 185, 129, 0.4);
      --button-danger-bg: rgba(239, 68, 68, 0.3);
      --button-danger-hover-bg: rgba(239, 68, 68, 0.4);
      --shadow-color: rgba(75, 156, 211, 0.3);
      --button-glow: 0 0 8px rgba(75, 156, 211, 0.3);
      --error-color: #ef4444;
      --telegram-block-bg: rgba(75, 156, 211, 0.3);
    }

    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--background-color);
      color: var(--text-color);
      overflow-x: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .container {
      max-width: 100%;
      width: 100%;
      margin: 0 auto;
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 16px;
      overflow-y: auto;
    }

    .header {
      position: sticky;
      top: 0;
      background: var(--header-bg);
      backdrop-filter: var(--card-blur);
      border: 1px solid var(--card-border);
      color: var(--text-color);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      font-family: 'Oswald', sans-serif;
      border-radius: 8px;
      transition: background-color 0.3s ease;
    }

    .header-title {
      font-size: clamp(20px, 4vw, 26px);
      font-weight: 700;
      text-align: center;
      text-shadow: 0 0 4px var(--text-color);
    }

    .back-button {
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 20px;
      cursor: pointer;
      padding: 4px 8px;
      position: absolute;
      left: 16px;
      transition: color 0.3s ease;
    }

    .back-button:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }

    .back-button:hover:not(:disabled) {
      color: var(--accent-color);
    }

    .content {
      flex: 1;
      padding: 16px 0;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .user-panel {
      background: var(--card-bg);
      backdrop-filter: var(--card-blur);
      border: 1px solid var(--card-border);
      padding: 20px;
      border-radius: 8px;
      box-shadow: var(--button-glow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      opacity: 0;
      animation: slideIn 0.5s ease-out forwards;
      transform: scale(1.1);
    }

    .user-panel:hover {
      transform: scale(1.12);
      box-shadow: 0 0 15px var(--shadow-color);
    }

    .user-panel-header {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      font-size: clamp(16px, 3vw, 18px);
      font-weight: 600;
      margin-bottom: 12px;
      gap: 8px;
    }

    .user-panel-header span {
      color: var(--accent-color);
    }

    .subscriptions-panel {
      background: var(--card-bg);
      backdrop-filter: var(--card-blur);
      border: 1px solid var(--card-border);
      padding: 16px;
      border-radius: 8px;
      box-shadow: var(--button-glow);
      transition: max-height 0.3s ease-out, transform 0.3s ease, box-shadow 0.3s ease;
      max-height: 0;
      overflow: hidden;
      opacity: 0;
    }

    .subscriptions-panel.open {
      max-height: 1000px;
      opacity: 1;
      padding: 16px;
    }

    .subscriptions-panel:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 15px var(--shadow-color);
    }

    .subscriptions-panel .subscription {
      background: var(--card-bg);
      backdrop-filter: var(--card-blur);
      border: 1px solid var(--card-border);
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 12px;
    }

    .subscriptions-panel .subscription h3 {
      font-size: clamp(14px, 2.5vw, 16px);
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .subscriptions-panel .subscription .status-error {
      color: var(--error-color);
      text-decoration: underline;
    }

    .subscriptions-panel .subscription .status-error::before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23ef4444' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='8'/%3E%3C/svg%3E");
      margin-right: 4px;
    }

    .subscriptions-panel .subscription p {
      font-size: clamp(12px, 2vw, 14px);
      margin-bottom: 6px;
    }

    .subscriptions-panel .subscription .details {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 8px;
      margin-bottom: 12px;
    }

    .subscriptions-panel .subscription .details b {
      font-weight: 600;
    }

    .subscriptions-panel .subscription .buttons {
      display: flex;
      gap: 8px;
    }

    .subscriptions-panel .subscription .buttons button {
      padding: 8px 12px;
      border-radius: 6px;
      font-size: clamp(12px, 2vw, 14px);
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.3s ease;
      background: var(--button-bg);
      backdrop-filter: var(--card-blur);
      border: 1px solid var(--card-border);
      color: var(--text-color);
    }

    .subscriptions-panel .subscription .buttons .copy-button {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .subscriptions-panel .subscription .buttons .copy-button:hover {
      background: var(--button-hover-bg);
      transform: translateY(-1px);
    }

    .subscriptions-panel .subscription .buttons .instruction-button {
      background: var(--button-secondary-bg);
    }

    .subscriptions-panel .subscription .buttons .instruction-button:hover {
      background: var(--button-secondary-hover-bg);
      transform: translateY(-1px);
    }

    .telegram-block {
      background: var(--telegram-block-bg);
      backdrop-filter: var(--card-blur);
      border: 1px solid var(--card-border);
      padding: 16px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.3s ease;
      opacity: 0;
      animation: slideIn 0.5s ease-out forwards;
    }

    .telegram-block:hover {
      background: var(--button-hover-bg);
      transform: translateY(-2px);
    }

    .telegram-block span {
      font-size: clamp(14px, 2.5vw, 16px);
      font-weight: 600;
      color: var(--text-color);
    }

    .telegram-block .icon {
      font-size: clamp(20px, 3vw, 24px);
      color: #ffffff;
    }

    .button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      font-size: clamp(14px, 2.5vw, 16px);
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
      font-family: 'Inter', sans-serif;
      background: var(--button-bg);
      backdrop-filter: var(--card-blur);
      border: 1px solid var(--card-border);
      color: var(--text-color);
      box-shadow: var(--button-glow);
      opacity: 0;
      animation: slideIn 0.5s ease-out forwards;
    }

    .button:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }

    .button:hover:not(:disabled) {
      background: var(--button-hover-bg);
      transform: translateY(-2px);
      box-shadow: 0 0 15px var(--shadow-color);
    }

    .button:active:not(:disabled) {
      transform: scale(0.98);
    }

    .button-primary {
      background: var(--button-bg);
      color: var(--text-color);
    }

    .button-primary:hover:not(:disabled) {
      background: var(--button-hover-bg);
    }

    .button-square {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px;
      background: var(--button-bg);
      backdrop-filter: var(--card-blur);
      border: 1px solid var(--card-border);
      color: var(--text-color);
      font-size: clamp(14px, 2.5vw, 16px);
      text-align: center;
      min-height: 120px;
      transform: scale(1.2);
    }

    .button-square:hover:not(:disabled) {
      background: var(--button-hover-bg);
      transform: scale(1.22);
      box-shadow: 0 0 15px var(--shadow-color);
    }

    .button-square .icon {
      width: clamp(160px, 30vw, 180px);
      height: clamp(160px, 30vw, 180px);
      color: #ffffff;
    }

    .button-secondary {
      background: var(--button-secondary-bg);
      color: var(--text-color);
    }

    .button-secondary:hover:not(:disabled) {
      background: var(--button-secondary-hover-bg);
    }

    .button-success {
      background: var(--button-success-bg);
      color: #ffffff;
    }

    .button-success:hover:not(:disabled) {
      background: var(--button-success-hover-bg);
    }

    .button-danger {
      background: var(--button-danger-bg);
      color: #ffffff;
    }

    .button-danger:hover:not(:disabled) {
      background: var(--button-danger-hover-bg);
    }

    .button-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .card {
      background: var(--card-bg);
      backdrop-filter: var(--card-blur);
      border: 1px solid var(--card-border);
      padding: 12px;
      border-radius: 8px;
      box-shadow: var(--button-glow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      opacity: 0;
      animation: slideIn 0.5s ease-out forwards;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 15px var(--shadow-color);
    }

    .card p {
      font-size: clamp(12px, 2.5vw, 14px);
      margin: 8px 0;
      color: var(--text-color);
    }

    .card b {
      color: var(--text-color);
      font-weight: 600;
    }

    .error {
      color: var(--error-color);
      font-size: clamp(12px, 2.5vw, 14px);
      text-align: center;
      margin-bottom: 16px;
      background: var(--card-bg);
      backdrop-filter: var(--card-blur);
      border: 1px solid var(--card-border);
      padding: 12px;
      border-radius: 8px;
      opacity: 0;
      animation: slideIn 0.5s ease-out forwards;
    }

    .link {
      color: var(--accent-color);
      text-decoration: none;
      font-weight: 600;
    }

    .link:hover {
      text-decoration: underline;
    }

    .tooltip {
      position: relative;
      display: inline-block;
      width: 100%;
    }

    .tooltip .tooltip-text {
      visibility: hidden;
      background: var(--card-bg);
      backdrop-filter: var(--card-blur);
      border: 1px solid var(--card-border);
      color: var(--text-color);
      text-align: center;
      border-radius: 4px;
      padding: 4px 8px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      font-size: clamp(11px, 2vw, 12px);
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }

    .clickable {
      color: var(--accent-color);
      cursor: pointer;
      font-weight: 600;
    }

    .clickable:hover {
      text-decoration: underline;
    }

    .clickable-manual {
      cursor: pointer;
      color: var(--text-color);
      font-weight: 600;
    }

    .clickable-manual:hover {
      color: var(--accent-color);
    }

    .manual-content {
      font-size: clamp(12px, 2.5vw, 14px);
      color: var(--text-color);
      line-height: 1.5;
    }

    .manual-content a {
      color: var(--accent-color);
      text-decoration: none;
      font-weight: 600;
    }

    .manual-content a:hover {
      text-decoration: underline;
    }

    .manual-content pre {
      background: var(--button-secondary-bg);
      backdrop-filter: var(--card-blur);
      border: 1px solid var(--card-border);
      padding: 8px;
      border-radius: 4px;
      overflow-x: auto;
    }

    .manual-content code {
      font-family: monospace;
      font-size: clamp(11px, 2vw, 12px);
    }

    .manual-content ul {
      list-style-type: disc;
      margin-left: 20px;
      margin-bottom: 8px;
    }

    .manual-content li {
      margin-bottom: 4px;
    }

    /* –ù–æ–≤—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .button:nth-child(1), .card:nth-child(1), .user-panel:nth-child(1), .telegram-block:nth-child(1) { animation-delay: 0.1s; }
    .button:nth-child(2), .card:nth-child(2) { animation-delay: 0.2s; }
    .button:nth-child(3), .card:nth-child(3) { animation-delay: 0.3s; }
    .button:nth-child(4), .card:nth-child(4) { animation-delay: 0.4s; }
    .subscriptions-panel { animation-delay: 0.5s; }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 600px) {
      .container {
        padding: 8px;
      }

      .header-title {
        font-size: clamp(18px, 4vw, 22px);
      }

      .button {
        font-size: clamp(12px, 2.5vw, 14px);
        padding: 10px 12px;
      }

      .button-square {
        font-size: clamp(12px, 2.5vw, 14px);
        padding: 10px;
        min-height: 100px;
      }

      .button-square .icon {
        width: clamp(140px, 30vw, 160px);
        height: clamp(140px, 30vw, 160px);
      }

      .user-panel-header {
        font-size: clamp(14px, 2.5vw, 16px);
      }

      .user-panel {
        transform: scale(1.05);
      }

      .user-panel:hover {
        transform: scale(1.07);
      }
    }

    @media (min-width: 1200px) {
      .container {
        max-width: min(80vw, 1400px);
      }

      .header-title {
        font-size: clamp(22px, 3vw, 28px);
      }

      .button {
        font-size: clamp(15px, 2vw, 17px);
        padding: 14px 18px;
      }

      .button-square {
        font-size: clamp(14px, 2vw, 16px);
        padding: 12px;
        min-height: 110px;
      }

      .button-square .icon {
        width: clamp(180px, 30vw, 200px);
        height: clamp(180px, 30vw, 200px);
      }

      .button-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
      }

      .user-panel {
        transform: scale(1.15);
      }

      .user-panel:hover {
        transform: scale(1.17);
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/javascript">
    const { useState, useEffect, createElement: h } = React;

    function debounce(func, wait) {
      let timeout;
      return function (...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    function App() {
      const [user, setUser] = useState(null);
      const [view, setView] = useState('main');
      const [subscriptions, setSubscriptions] = useState([]);
      const [referrals, setReferrals] = useState([]);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      const [paymentData, setPaymentData] = useState(() => {
        const saved = localStorage.getItem('paymentData');
        return saved ? JSON.parse(saved) : null;
      });
      const [selectedSub, setSelectedSub] = useState(() => {
        const saved = localStorage.getItem('selectedSub');
        return saved ? JSON.parse(saved) : null;
      });
      const [selectedReferee, setSelectedReferee] = useState(null);
      const [processingActions, setProcessingActions] = useState({});
      const [isSubscriptionsOpen, setIsSubscriptionsOpen] = useState(false);

      const API_URL = 'https://wsocks-api-bot-git.onrender.com';
      const SUPPORT_LINK = 'https://t.me/WSocks_Support';
      const SUPPORT_HANDLE = '@WSocks_Support';
      const BOT_USERNAME = '@YourBot';
      const APP_DOWNLOAD_LINK = 'https://example.com/download';
      const TELEGRAM_CHANNEL_LINK = 'https://t.me/WSocks_Channel';

      const axiosInstance = axios.create({ timeout: 0 });

      useEffect(() => {
        localStorage.setItem('view', view);
        localStorage.setItem('paymentData', JSON.stringify(paymentData));
        localStorage.setItem('selectedSub', JSON.stringify(selectedSub));
      }, [view, paymentData, selectedSub]);

      useEffect(() => {
        console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...');
        if (!window.Telegram || !window.Telegram.WebApp) {
          setError('Telegram Web App SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
          setLoading(false);
          return;
        }

        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        const initData = Telegram.WebApp.initData;
        console.log('InitData:', initData);

        if (!initData) {
          setError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å initData');
          setLoading(false);
          return;
        }

        setLoading(true);
        axiosInstance.post(`${API_URL}/api/auth`, { init_data: initData }, {
          headers: { 'Cache-Control': 'no-cache' }
        })
          .then(({ data }) => {
            console.log('–û—Ç–≤–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', data);
            setUser(data.user);
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            Promise.all([fetchSubscriptions(), fetchReferrals()])
              .catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', err);
                setError(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${err.message}`);
              })
              .finally(() => setLoading(false));
          })
          .catch(err => {
            console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', err);
            setError(`–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${err.response?.data?.detail || err.message}`);
            setLoading(false);
          });
      }, []);

      const fetchSubscriptions = async () => {
        if (!user) {
          setError('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
          return;
        }
        try {
          const response = await axiosInstance.get(`${API_URL}/api/subscriptions?tg_id=${user.telegram_id}`, {
            headers: { 'Cache-Control': 'no-cache' }
          });
          console.log('–û—Ç–≤–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫:', response.data);
          setSubscriptions(response.data.subscriptions || []);
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫:', err);
          setError(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–æ–∫: ${err.response?.data?.detail || err.message}`);
        }
      };

      const fetchReferrals = async () => {
        if (!user) {
          setError('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
          return;
        }
        try {
          const response = await axiosInstance.get(`${API_URL}/api/referrals?tg_id=${user.telegram_id}`, {
            headers: { 'Cache-Control': 'no-cache' }
          });
          console.log('–û—Ç–≤–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:', response.data);
          setReferrals(response.data.referrals || []);
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:', err);
          setError(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤: ${err.response?.data?.detail || err.message}`);
        }
      };

      const activateSubscription = debounce(async (days, isExtension = false, email = null, requestId) => {
        if (!user) {
          setError('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
          return;
        }
        if (processingActions[requestId]) {
          return;
        }
        setProcessingActions(prev => ({ ...prev, [requestId]: true }));
        setLoading(true);
        setError(null);
        try {
          const endpoint = isExtension ? '/api/extend-subscription' : '/api/buy-subscription';
          const payload = isExtension 
            ? { tg_id: user.telegram_id, days, email }
            : { tg_id: user.telegram_id, days };
          const response = await axiosInstance.post(`${API_URL}${endpoint}`, payload);
          console.log('–û—Ç–≤–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏:', response.data);
          setPaymentData({ ...response.data, isExtension });
          setView('payment');
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏:', err);
          setError(`–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏: ${err.response?.data?.detail || err.message}`);
        } finally {
          setLoading(false);
          setProcessingActions(prev => ({ ...prev, [requestId]: false }));
        }
      }, 500);

      const activateTrial = debounce(async () => {
        if (!user) {
          setError('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
          return;
        }
        const requestId = generateRequestId();
        if (processingActions[requestId]) {
          return;
        }
        setProcessingActions(prev => ({ ...prev, [requestId]: true }));
        setLoading(true);
        setError(null);
        try {
          const response = await axiosInstance.post(`${API_URL}/api/activate-trial`, { tg_id: user.telegram_id });
          console.log('–û—Ç–≤–µ—Ç –ø—Ä–æ–±–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏:', response.data);
          await fetchSubscriptions();
          Telegram.WebApp.showAlert(`–ü—Ä–æ–±–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ 3 –¥–Ω—è –¥–æ ${response.data.expiry_date}!`);
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–±–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏:', err);
          Telegram.WebApp.showAlert(err.response?.data?.detail || '–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–±–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏');
        } finally {
          setLoading(false);
          setProcessingActions(prev => ({ ...prev, [requestId]: false }));
        }
      }, 500);

      const applyReferralBonus = debounce(async (referee_id, email = null) => {
        if (!user) {
          setError('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
          return;
        }
        const requestId = generateRequestId();
        if (processingActions[requestId]) {
          return;
        }
        setProcessingActions(prev => ({ ...prev, [requestId]: true }));
        setLoading(true);
        setError(null);
        try {
          const nonTrialSubs = subscriptions.filter(sub => !sub.email.startsWith('DE-FRA-TRIAL-'));
          if (nonTrialSubs.length > 1 && !email) {
            setSelectedReferee(referee_id);
            setView('selectsubscription');
            return;
          }
          const payload = { tg_id: user.telegram_id, referee_id, email };
          const response = await axiosInstance.post(`${API_URL}/api/apply-referral-bonus`, payload);
          console.log('–û—Ç–≤–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞:', response.data);
          await fetchSubscriptions();
          await fetchReferrals();
          Telegram.WebApp.showAlert(
            response.data.email.startsWith('DE-FRA-USER-')
              ? `–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ 7 –¥–Ω–µ–π –¥–æ ${response.data.expiry_date}!`
              : `–ü–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–ª–µ–Ω–∞ –Ω–∞ 7 –¥–Ω–µ–π –¥–æ ${response.data.expiry_date}!`
          );
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞:', err);
          setError(`–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞: ${err.response?.data?.detail || err.message}`);
        } finally {
          setLoading(false);
          setProcessingActions(prev => ({ ...prev, [requestId]: false }));
        }
      }, 500);

      const confirmActivation = async () => {
        if (!user || !paymentData) {
          setError('–î–∞–Ω–Ω—ã–µ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');
          return;
        }
        setLoading(true);
        setError(null);
        try {
          setView('subscriptions');
          await fetchSubscriptions();
          Telegram.WebApp.showAlert(
            paymentData.isExtension 
              ? `–ü–æ–¥–ø–∏—Å–∫–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–¥–ª–µ–Ω–∞ –Ω–∞ ${paymentData.days} –¥–Ω–µ–π –¥–æ ${paymentData.expiry_date}!` 
              : `–ü–æ–¥–ø–∏—Å–∫–∞ —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ ${paymentData.days} –¥–Ω–µ–π –¥–æ ${paymentData.expiry_date}!`
          );
          setPaymentData(null);
          localStorage.removeItem('paymentData');
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:', err);
          setError(`–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏: ${err.message}`);
        } finally {
          setLoading(false);
        }
      };

      const handleRetry = (action) => {
        setError(null);
        action();
      };

      const generateRequestId = () => {
        return `${Date.now()}_${Math.random().toString(36).substring(2, 11)}`;
      };

      const copyToClipboard = (text) => {
        navigator.clipboard.writeText(text).then(() => {
          Telegram.WebApp.showAlert('–ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
        }).catch(err => {
          console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
          Telegram.WebApp.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á');
        });
      };

      const toggleSubscriptionsPanel = () => {
        setIsSubscriptionsOpen(!isSubscriptionsOpen);
      };

      const Header = ({ title, onBack }) => {
        const children = [];
        if (onBack) {
          children.push(h('button', { className: 'back-button', onClick: onBack, disabled: loading }, 
            h('svg', { width: '20', height: '20', fill: '#ffffff', viewBox: '0 0 24 24' }, 
              h('path', { d: 'M15 18l-6-6 6-6' })
            )
          ));
        }
        children.push(h('div', { className: 'header-title' }, title));
        return h('div', { className: 'header' }, children);
      };

      const renderMainMenu = () => {
        const contentChildren = [];

        if (user) {
          contentChildren.push(
            h('div', { className: 'user-panel' }, [
              h('div', { className: 'user-panel-header' }, [
                h('span', null, [
                  h('svg', { width: '16', height: '16', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                    h('path', { d: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2a7.2 7.2 0 01-6-3.22c.03-1.99 4-3.08 6-3.08s5.97 1.09 6 3.08a7.2 7.2 0 01-6 3.22z' })
                  ),
                  ` –ö–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞: ${user.first_name}`
                ]),
                h('span', null, `–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫: ${subscriptions.length}`),
                h('span', null, `–†–µ—Ñ–µ—Ä–∞–ª–æ–≤: ${referrals.length}`)
              ])
            ]),
            h('button', { className: 'button button-primary', onClick: toggleSubscriptionsPanel }, isSubscriptionsOpen ? '–°–∫—Ä—ã—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏'),
            h('div', { className: `subscriptions-panel ${isSubscriptionsOpen ? 'open' : ''}` }, 
              subscriptions.length === 0
                ? [h('p', null, '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫')]
                : subscriptions.map((sub, index) => {
                    const isExpired = sub.is_expired;
                    return h('div', { key: index, className: 'subscription' }, [
                      h('h3', null, [
                        h('svg', { width: '16', height: '16', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                          h('path', { d: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z' })
                        ),
                        ` –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ #${sub.email.split('-').pop()}`,
                        isExpired ? h('span', { className: 'status-error' }, '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ') : null
                      ]),
                      h('p', null, [
                        h('svg', { width: '16', height: '16', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                          h('path', { d: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z' })
                        ),
                        ` –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ: ${new Date(sub.expiry_date).toLocaleString('ru-RU', { timeZone: 'UTC' })} UTC`
                      ]),
                      h('div', { className: 'details' }, [
                        h('b', null, '–¢–∞—Ä–∏—Ñ:'), h('span', null, '3 WP/–¥–µ–Ω—å'),
                        h('b', null, '–†–µ–≥–∏–æ–Ω:'), h('span', null, '–§—Ä–∞–Ω–∫—Ñ—É—Ä—Ç'),
                        h('b', null, '–°—Ç–∞—Ç—É—Å:'), h('span', { className: isExpired ? 'status-error' : '' }, isExpired ? 'üî¥ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ' : 'üü¢ –ê–∫—Ç–∏–≤–Ω–æ'),
                        h('b', null, '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:'), h('a', { className: 'link', href: APP_DOWNLOAD_LINK, onClick: () => Telegram.WebApp.openLink(APP_DOWNLOAD_LINK) }, '–°–∫–∞—á–∞—Ç—å'),
                        h('b', null, '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:'), h('span', null, '–°–º–∞—Ä—Ç—Ñ–æ–Ω')
                      ]),
                      h('div', { className: 'buttons' }, [
                        h('button', { className: 'copy-button', onClick: () => copyToClipboard(sub.email), disabled: loading }, [
                          h('svg', { width: '16', height: '16', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                            h('path', { d: 'M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z' })
                          ),
                          ' –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å'
                        ]),
                        h('button', { className: 'instruction-button', onClick: () => { setSelectedSub(sub); setView('setup'); }, disabled: loading }, [
                          h('svg', { width: '16', height: '16', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                            h('path', { d: 'M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z' })
                          ),
                          ' –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è'
                        ])
                      ])
                    ]);
                  })
            )
          );
        }

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => window.location.reload() }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-danger', onClick: () => Telegram.WebApp.close() }, '–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ')
          );
        } else {
          contentChildren.push(
            h('div', { className: 'button-grid' }, [
              h('div', { className: 'tooltip' }, [
                h('button', { className: 'button button-square', onClick: () => setView('subscriptions'), disabled: loading }, [
                  h('svg', { className: 'icon', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                    h('path', { d: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6z' })
                  ),
                  h('span', null, '–ü–æ–¥–ø–∏—Å–∫–∏')
                ]),
                h('span', { className: 'tooltip-text' }, '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–∏–º–∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏')
              ]),
              h('div', { className: 'tooltip' }, [
                h('button', { className: 'button button-square', onClick: () => setView('referrals'), disabled: loading }, [
                  h('svg', { className: 'icon', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                    h('path', { d: 'M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z' })
                  ),
                  h('span', null, '–†–µ—Ñ–µ—Ä–∞–ª—ã')
                ]),
                h('span', { className: 'tooltip-text' }, '–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –±–æ–Ω—É—Å—ã')
              ]),
              h('div', { className: 'tooltip' }, [
                h('button', { className: 'button button-square', onClick: () => setView('support'), disabled: loading }, [
                  h('svg', { className: 'icon', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                    h('path', { d: 'M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z' })
                  ),
                  h('span', null, '–ü–æ–¥–¥–µ—Ä–∂–∫–∞')
                ]),
                h('span', { className: 'tooltip-text' }, '–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π')
              ]),
              h('div', { className: 'tooltip' }, [
                h('button', { className: 'button button-square', onClick: () => setView('info'), disabled: loading }, [
                  h('svg', { className: 'icon', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                    h('path', { d: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z' })
                  ),
                  h('span', null, '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è')
                ]),
                h('span', { className: 'tooltip-text' }, '–£–∑–Ω–∞–π—Ç–µ –±–æ–ª—å—à–µ –æ WSocks VPN')
              ])
            ]),
            h('div', { className: 'telegram-block', onClick: () => Telegram.WebApp.openLink(TELEGRAM_CHANNEL_LINK) }, [
              h('svg', { className: 'icon', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                h('path', { d: 'M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71L12.6 16.3l-1.99 1.93c-.23.23-.42.42-.83.42z' })
              ),
              h('span', null, '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –Ω–∞—à –¢–ì–ö')
            ])
          );
        }

        return h('div', { className: 'container' }, [
          Header({ title: '' }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const renderSupport = () => {
        const contentChildren = [];

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('support')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-secondary', onClick: () => setView('main') }, '–ù–∞–∑–∞–¥')
          );
        } else {
          contentChildren.push(
            h('div', { className: 'card' }, [
              h('p', null, [
                '–î–ª—è —Å–≤—è–∑–∏ —Å –Ω–∞—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—é–¥–∞, ',
                h('span', { className: 'clickable', onClick: () => Telegram.WebApp.openLink(SUPPORT_LINK) }, SUPPORT_HANDLE),
                ' –∏ –Ω–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –æ—Ç–≤–µ—Ç–∏—Ç –≤–∞–º –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è!'
              ]),
              h('p', null, [
                '–í–∞—à id –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º: ',
                h('span', { className: 'clickable', onClick: () => copyToClipboard(user.telegram_id) }, user.telegram_id)
              ]),
              h('p', { style: { fontStyle: 'italic' } }, '(–Ω–∞–∂–º–∏—Ç–µ –Ω–∞ id —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å)')
            ]),
            h('button', { className: 'button button-secondary', onClick: () => setView('main'), disabled: loading }, '–ù–∞–∑–∞–¥')
          );
        }

        return h('div', { className: 'container' }, [
          Header({ title: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞', onBack: () => setView('main') }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const renderReferrals = () => {
        const contentChildren = [];

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => handleRetry(fetchReferrals) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-secondary', onClick: () => setView('main') }, '–ù–∞–∑–∞–¥')
          );
        } else {
          contentChildren.push(
            h('p', { className: 'card' }, [
              '–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ ',
              h('b', null, '7 –¥–Ω–µ–π'),
              ' –±–µ—Å–ø–ª–∞—Ç–Ω–æ:'
            ])
          );

          if (user) {
            contentChildren.push(
              h('div', { className: 'card' }, [
                h('p', null, [
                  '–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: ',
                  h('span', { className: 'clickable', onClick: () => copyToClipboard(`${BOT_USERNAME}?start=ref_${user.telegram_id}`) }, `${BOT_USERNAME}?start=ref_${user.telegram_id}`)
                ]),
                h('p', { style: { fontStyle: 'italic' } }, '(–Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å)')
              ])
            );
          }

          if (referrals.length === 0) {
            contentChildren.push(h('p', { className: 'card' }, '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤.'));
          } else {
            referrals.forEach((ref, index) => {
              const cardChildren = [
                h('p', null, [h('b', null, 'ID —Ä–µ—Ñ–µ—Ä–∞–ª–∞: '), ref.referee_id])
              ];
              if (ref.bonus_applied) {
                cardChildren.push(
                  h('p', null, [h('b', null, '–ë–æ–Ω—É—Å –ø–æ–ª—É—á–µ–Ω: '), new Date(ref.bonus_date).toLocaleString()])
                );
              } else {
                cardChildren.push(
                  h('button', { className: 'button button-success', onClick: () => applyReferralBonus(ref.referee_id), disabled: loading }, '–ü–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å')
                );
              }
              contentChildren.push(h('div', { key: index, className: 'card' }, cardChildren));
            });
          }

          contentChildren.push(
            h('button', { className: 'button button-secondary', onClick: () => setView('main'), disabled: loading }, '–ù–∞–∑–∞–¥')
          );
        }

        return h('div', { className: 'container' }, [
          Header({ title: '–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞', onBack: () => setView('main') }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const renderSubscriptions = () => {
        const contentChildren = [];

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => handleRetry(fetchSubscriptions) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-secondary', onClick: () => setView('main') }, '–ù–∞–∑–∞–¥')
          );
        } else {
          if (subscriptions.length === 0) {
            contentChildren.push(h('p', { className: 'card' }, '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫.'));
          } else {
            subscriptions.forEach((sub, index) => {
              const isExpired = sub.is_expired;
              const cardChildren = [
                h('h3', null, [
                  h('svg', { width: '16', height: '16', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                    h('path', { d: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z' })
                  ),
                  ` –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ #${sub.email.split('-').pop()}`,
                  isExpired ? h('span', { className: 'status-error' }, '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ') : null
                ]),
                h('p', null, [
                  h('svg', { width: '16', height: '16', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                    h('path', { d: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm0-4h-2V7h2v6z' })
                  ),
                  ` –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ: ${new Date(sub.expiry_date).toLocaleString('ru-RU', { timeZone: 'UTC' })} UTC`
                ]),
                h('div', { className: 'details' }, [
                  h('b', null, '–¢–∞—Ä–∏—Ñ:'), h('span', null, '3 WP/–¥–µ–Ω—å'),
                  h('b', null, '–†–µ–≥–∏–æ–Ω:'), h('span', null, '–§—Ä–∞–Ω–∫—Ñ—É—Ä—Ç'),
                  h('b', null, '–°—Ç–∞—Ç—É—Å:'), h('span', { className: isExpired ? 'status-error' : '' }, isExpired ? 'üî¥ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ' : 'üü¢ –ê–∫—Ç–∏–≤–Ω–æ'),
                  h('b', null, '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:'), h('a', { className: 'link', href: APP_DOWNLOAD_LINK, onClick: () => Telegram.WebApp.openLink(APP_DOWNLOAD_LINK) }, '–°–∫–∞—á–∞—Ç—å'),
                  h('b', null, '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:'), h('span', null, '–°–º–∞—Ä—Ç—Ñ–æ–Ω')
                ]),
                h('div', { className: 'buttons' }, [
                  h('button', { className: 'copy-button', onClick: () => copyToClipboard(sub.email), disabled: loading }, [
                    h('svg', { width: '16', height: '16', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                      h('path', { d: 'M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z' })
                    ),
                    ' –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å'
                  ]),
                  h('button', { className: 'instruction-button', onClick: () => { setSelectedSub(sub); setView('setup'); }, disabled: loading }, [
                    h('svg', { width: '16', height: '16', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                      h('path', { d: 'M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z' })
                    ),
                    ' –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è'
                  ])
                ])
              ];
              contentChildren.push(h('div', { key: index, className: 'card' }, cardChildren));
            });
          }

          contentChildren.push(
            h('div', { className: 'tooltip' }, [
              h('button', { className: 'button button-primary', onClick: activateTrial, disabled: loading }, '–ü—Ä–æ–±–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞'),
              h('span', { className: 'tooltip-text' }, '–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ 3 –¥–Ω—è')
            ]),
            h('button', { className: 'button button-primary', onClick: () => setView('buy'), disabled: loading }, '–ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É'),
            h('button', { className: 'button button-secondary', onClick: () => setView('main'), disabled: loading }, '–ù–∞–∑–∞–¥')
          );
        }

        return h('div', { className: 'container' }, [
          Header({ title: '–ü–æ–¥–ø–∏—Å–∫–∏', onBack: () => setView('main') }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const renderBuy = () => {
        const contentChildren = [];

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => handleRetry(() => activateSubscription(30, false, null, generateRequestId())) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-secondary', onClick: () => setView('subscriptions') }, '–ù–∞–∑–∞–¥')
          );
        } else {
          contentChildren.push(
            h('button', { className: 'button button-primary', onClick: () => activateSubscription(30, false, null, generateRequestId()), disabled: loading || processingActions['buy-30'] }, '30 –¥–Ω–µ–π - 89 ‚ÇΩ'),
            h('button', { className: 'button button-primary', onClick: () => activateSubscription(90, false, null, generateRequestId()), disabled: loading || processingActions['buy-90'] }, '90 –¥–Ω–µ–π - 249 ‚ÇΩ'),
            h('button', { className: 'button button-primary', onClick: () => activateSubscription(180, false, null, generateRequestId()), disabled: loading || processingActions['buy-180'] }, '180 –¥–Ω–µ–π - 449 ‚ÇΩ'),
            h('button', { className: 'button button-primary', onClick: () => activateSubscription(360, false, null, generateRequestId()), disabled: loading || processingActions['buy-360'] }, '360 –¥–Ω–µ–π - 849 ‚ÇΩ'),
            h('button', { className: 'button button-secondary', onClick: () => setView('subscriptions'), disabled: loading }, '–ù–∞–∑–∞–¥')
          );
        }

        return h('div', { className: 'container' }, [
          Header({ title: '–ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É', onBack: () => setView('subscriptions') }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const renderExtend = () => {
        const contentChildren = [];

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => handleRetry(() => activateSubscription(30, true, selectedSub.email, generateRequestId())) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-secondary', onClick: () => setView('subscriptions') }, '–ù–∞–∑–∞–¥')
          );
        } else {
          if (selectedSub) {
            contentChildren.push(
              h('p', { className: 'card' }, [h('b', null, 'Email: '), selectedSub.email]),
              h('p', { className: 'card' }, [h('b', null, '–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è: '), new Date(selectedSub.expiry_date).toLocaleString()])
            );
          }
          contentChildren.push(
            h('button', { className: 'button button-primary', onClick: () => activateSubscription(30, true, selectedSub ? selectedSub.email : null, generateRequestId()), disabled: loading || processingActions['extend-30'] }, '–ü—Ä–æ–¥–ª–∏—Ç—å –Ω–∞ 30 –¥–Ω–µ–π - 89 ‚ÇΩ'),
            h('button', { className: 'button button-primary', onClick: () => activateSubscription(90, true, selectedSub ? selectedSub.email : null, generateRequestId()), disabled: loading || processingActions['extend-90'] }, '–ü—Ä–æ–¥–ª–∏—Ç—å –Ω–∞ 90 –¥–Ω–µ–π - 249 ‚ÇΩ'),
            h('button', { className: 'button button-primary', onClick: () => activateSubscription(180, true, selectedSub ? selectedSub.email : null, generateRequestId()), disabled: loading || processingActions['extend-180'] }, '–ü—Ä–æ–¥–ª–∏—Ç—å –Ω–∞ 180 –¥–Ω–µ–π - 449 ‚ÇΩ'),
            h('button', { className: 'button button-primary', onClick: () => activateSubscription(360, true, selectedSub ? selectedSub.email : null, generateRequestId()), disabled: loading || processingActions['extend-360'] }, '–ü—Ä–æ–¥–ª–∏—Ç—å –Ω–∞ 360 –¥–Ω–µ–π - 849 ‚ÇΩ'),
            h('button', { className: 'button button-secondary', onClick: () => setView('subscriptions'), disabled: loading }, '–ù–∞–∑–∞–¥')
          );
        }

        return h('div', { className: 'container' }, [
          Header({ title: '–ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É', onBack: () => setView('subscriptions') }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const renderSelectSubscription = () => {
        const contentChildren = [];

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => handleRetry(() => applyReferralBonus(selectedReferee)) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-secondary', onClick: () => setView('referrals') }, '–ù–∞–∑–∞–¥')
          );
        } else {
          contentChildren.push(h('p', { className: 'card' }, '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è –Ω–∞ 7 –¥–Ω–µ–π:'));
          const nonTrialSubs = subscriptions.filter(sub => !sub.email.startsWith('DE-FRA-TRIAL-'));
          nonTrialSubs.forEach((sub, index) => {
            contentChildren.push(
              h('div', { key: index, className: 'card' }, [
                h('h3', null, [
                  h('svg', { width: '16', height: '16', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                    h('path', { d: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z' })
                  ),
                  ` –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ #${sub.email.split('-').pop()}`,
                  sub.is_expired ? h('span', { className: 'status-error' }, '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ') : null
                ]),
                h('p', null, [
                  h('svg', { width: '16', height: '16', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                    h('path', { d: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm0-4h-2V7h2v6z' })
                  ),
                  ` –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ: ${new Date(sub.expiry_date).toLocaleString('ru-RU', { timeZone: 'UTC' })} UTC`
                ]),
                h('div', { className: 'details' }, [
                  h('b', null, '–¢–∞—Ä–∏—Ñ:'), h('span', null, '3 WP/–¥–µ–Ω—å'),
                  h('b', null, '–†–µ–≥–∏–æ–Ω:'), h('span', null, '–§—Ä–∞–Ω–∫—Ñ—É—Ä—Ç'),
                  h('b', null, '–°—Ç–∞—Ç—É—Å:'), h('span', { className: sub.is_expired ? 'status-error' : '' }, sub.is_expired ? 'üî¥ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ' : 'üü¢ –ê–∫—Ç–∏–≤–Ω–æ'),
                  h('b', null, '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:'), h('a', { className: 'link', href: APP_DOWNLOAD_LINK, onClick: () => Telegram.WebApp.openLink(APP_DOWNLOAD_LINK) }, '–°–∫–∞—á–∞—Ç—å'),
                  h('b', null, '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:'), h('span', null, '–°–º–∞—Ä—Ç—Ñ–æ–Ω')
                ]),
                h('div', { className: 'buttons' }, [
                  h('button', { className: 'copy-button', onClick: () => copyToClipboard(sub.email), disabled: loading }, [
                    h('svg', { width: '16', height: '16', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                      h('path', { d: 'M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z' })
                    ),
                    ' –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å'
                  ]),
                  h('button', { className: 'instruction-button', onClick: () => { setSelectedSub(sub); setView('setup'); }, disabled: loading }, [
                    h('svg', { width: '16', height: '16', fill: '#ffffff', viewBox: '0 0 24 24' }, 
                      h('path', { d: 'M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z' })
                    ),
                    ' –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è'
                  ])
                ])
              ])
            );
          });
          contentChildren.push(h('button', { className: 'button button-secondary', onClick: () => setView('referrals'), disabled: loading }, '–ù–∞–∑–∞–¥'));
        }

        return h('div', { className: 'container' }, [
          Header({ title: '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É', onBack: () => setView('referrals') }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const renderPayment = () => {
        const contentChildren = [];

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => handleRetry(confirmActivation) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-secondary', onClick: () => { setPaymentData(null); localStorage.removeItem('paymentData'); setView('subscriptions'); } }, '–ù–∞–∑–∞–¥')
          );
        } else if (paymentData) {
          contentChildren.push(
            h('p', { className: 'card' }, `–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ ${paymentData.days} –¥–Ω–µ–π`),
            h('p', { className: 'card' }, [h('b', null, '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: '), paymentData.email]),
            h('p', { className: 'card' }, [h('b', null, '–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è: '), new Date(paymentData.expiry_date).toLocaleString()]),
            h('button', { className: 'button button-success', onClick: confirmActivation, disabled: loading }, '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å'),
            h('button', { className: 'button button-danger', onClick: () => { setPaymentData(null); localStorage.removeItem('paymentData'); setView('subscriptions'); }, disabled: loading }, '–û—Ç–º–µ–Ω–∞')
          );
        }

        return h('div', { className: 'container' }, [
          Header({ title: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏', onBack: () => { setPaymentData(null); localStorage.removeItem('paymentData'); setView('subscriptions'); } }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const renderSetup = () => {
        const contentChildren = [];

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('setup')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-secondary', onClick: () => setView('subscriptions') }, '–ù–∞–∑–∞–¥')
          );
        } else {
          if (selectedSub) {
            contentChildren.push(h('p', { className: 'card' }, [h('b', null, 'Email: '), selectedSub.email]));
          }
          contentChildren.push(
            h('button', { className: 'button button-primary', onClick: () => setView('manualPC'), disabled: loading }, window.TEXTS.setup.manualPC.title),
            h('button', { className: 'button button-primary', onClick: () => setView('manualAndroid'), disabled: loading }, window.TEXTS.setup.manualAndroid.title),
            h('button', { className: 'button button-primary', onClick: () => setView('manualIOS'), disabled: loading }, window.TEXTS.setup.manualIOS.title),
            h('button', { className: 'button button-primary', onClick: () => setView('manualAndroidTV'), disabled: loading }, window.TEXTS.setup.manualAndroidTV.title),
            h('button', { className: 'button button-secondary', onClick: () => setView('subscriptions'), disabled: loading }, '–ù–∞–∑–∞–¥')
          );
        }

        return h('div', { className: 'container' }, [
          Header({ title: '–ù–∞—Å—Ç—Ä–æ–π–∫–∞', onBack: () => setView('subscriptions') }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const renderManualPC = () => {
        const contentChildren = [];

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('manualPC')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-secondary', onClick: () => setView('setup') }, '–ù–∞–∑–∞–¥')
          );
        } else if (selectedSub) {
          contentChildren.push(
            h('div', { className: 'card' }, [
              h('div', { className: 'manual-content', dangerouslySetInnerHTML: { __html: window.TEXTS.setup.manualPC.content(selectedSub) } })
            ]),
                        h('button', { className: 'button button-secondary', onClick: () => setView('setup'), disabled: loading }, '–ù–∞–∑–∞–¥')
          );
        }

        return h('div', { className: 'container' }, [
          Header({ title: window.TEXTS.setup.manualPC.title, onBack: () => setView('setup') }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const renderManualAndroid = () => {
        const contentChildren = [];

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('manualAndroid')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-secondary', onClick: () => setView('setup') }, '–ù–∞–∑–∞–¥')
          );
        } else if (selectedSub) {
          contentChildren.push(
            h('div', { className: 'card' }, [
              h('div', { className: 'manual-content', dangerouslySetInnerHTML: { __html: window.TEXTS.setup.manualAndroid.content } })
            ]),
            h('button', { className: 'button button-secondary', onClick: () => setView('setup'), disabled: loading }, '–ù–∞–∑–∞–¥')
          );
        }

        return h('div', { className: 'container' }, [
          Header({ title: window.TEXTS.setup.manualAndroid.title, onBack: () => setView('setup') }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const renderManualIOS = () => {
        const contentChildren = [];

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('manualIOS')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-secondary', onClick: () => setView('setup') }, '–ù–∞–∑–∞–¥')
          );
        } else if (selectedSub) {
          contentChildren.push(
            h('div', { className: 'card' }, [
              h('div', { className: 'manual-content', dangerouslySetInnerHTML: { __html: window.TEXTS.setup.manualIOS.content } })
            ]),
            h('button', { className: 'button button-secondary', onClick: () => setView('setup'), disabled: loading }, '–ù–∞–∑–∞–¥')
          );
        }

        return h('div', { className: 'container' }, [
          Header({ title: window.TEXTS.setup.manualIOS.title, onBack: () => setView('setup') }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const renderManualAndroidTV = () => {
        const contentChildren = [];

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('manualAndroidTV')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-secondary', onClick: () => setView('setup') }, '–ù–∞–∑–∞–¥')
          );
        } else if (selectedSub) {
          contentChildren.push(
            h('div', { className: 'card' }, [
              h('div', { className: 'manual-content', dangerouslySetInnerHTML: { __html: window.TEXTS.setup.manualAndroidTV.content(selectedSub) } })
            ]),
            h('button', { className: 'button button-secondary', onClick: () => setView('setup'), disabled: loading }, '–ù–∞–∑–∞–¥')
          );
        }

        return h('div', { className: 'container' }, [
          Header({ title: window.TEXTS.setup.manualAndroidTV.title, onBack: () => setView('setup') }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const renderInfo = () => {
        const contentChildren = [];

        if (error) {
          contentChildren.push(
            h('p', { className: 'error' }, error),
            h('button', { className: 'button button-primary', onClick: () => handleRetry(() => setView('info')) }, '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            h('button', { className: 'button button-secondary', onClick: () => setView('main') }, '–ù–∞–∑–∞–¥')
          );
        } else {
          contentChildren.push(
            h('div', { className: 'card' }, [
              h('div', { className: 'manual-content', dangerouslySetInnerHTML: { __html: window.TEXTS.terms.content } })
            ]),
            h('button', { className: 'button button-secondary', onClick: () => setView('main'), disabled: loading }, '–ù–∞–∑–∞–¥')
          );
        }

        return h('div', { className: 'container' }, [
          Header({ title: window.TEXTS.terms.title, onBack: () => setView('main') }),
          h('div', { className: 'content' }, contentChildren)
        ]);
      };

      const views = {
        main: renderMainMenu,
        support: renderSupport,
        referrals: renderReferrals,
        subscriptions: renderSubscriptions,
        buy: renderBuy,
        extend: renderExtend,
        selectsubscription: renderSelectSubscription,
        payment: renderPayment,
        setup: renderSetup,
        manualPC: renderManualPC,
        manualAndroid: renderManualAndroid,
        manualIOS: renderManualIOS,
        manualAndroidTV: renderManualAndroidTV,
        info: renderInfo
      };

      return views[view] ? views[view]() : h('div', { className: 'container' }, [
        Header({ title: '–û—à–∏–±–∫–∞' }),
        h('div', { className: 'content' }, [
          h('p', { className: 'error' }, '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –≤–∏–¥'),
          h('button', { className: 'button button-secondary', onClick: () => setView('main') }, '–ù–∞–∑–∞–¥')
        ])
      ]);
    }

    ReactDOM.render(h(App), document.getElementById('root'));
  </script>
</body>
</html>
